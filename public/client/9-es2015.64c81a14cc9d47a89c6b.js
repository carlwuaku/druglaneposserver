(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"4j6H":function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var s=i("fXoL"),n=i("c92J"),r=i("1VJT"),o=i("BbYg"),c=i("ccyI"),a=i("ofXK"),l=i("hiAm"),h=i("3Pt+"),d=i("tyNb");function u(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function p(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275elementStart"](1,"h4"),s["\u0275\u0275text"](2,"Not found"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]())}function f(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"option",8),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275propertyInterpolate"]("value",e.id),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function m(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275elementStart"](1,"label"),s["\u0275\u0275text"](2,"Select Product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"select",6),s["\u0275\u0275listener"]("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"](2).select_product=t}))("change",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"](2).productSelected()})),s["\u0275\u0275template"](4,f,2,2,"option",7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"](2);s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("ngModel",e.select_product),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngForOf",e.objects)}}function _(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div",2),s["\u0275\u0275elementStart"](1,"div",3),s["\u0275\u0275elementStart"](2,"button",4),s["\u0275\u0275listener"]("click",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().addProduct()})),s["\u0275\u0275text"](3,"Add Product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](4,u,1,0,"app-loading",5),s["\u0275\u0275template"](5,p,3,0,"div",5),s["\u0275\u0275template"](6,m,5,2,"div",5),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngIf",e.is_searching),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.error_search),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.is_finished_search)}}function g(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275elementStart"](1,"b"),s["\u0275\u0275text"](2,"Not found"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]())}const v=function(e){return{"select-product-active":e}};function y(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"li",17),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](e);const i=t.$implicit;return s["\u0275\u0275nextContext"](3).add(i)})),s["\u0275\u0275text"](1),s["\u0275\u0275element"](2,"br"),s["\u0275\u0275text"](3),s["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,i=t.index,n=s["\u0275\u0275nextContext"](3);s["\u0275\u0275property"]("ngClass",s["\u0275\u0275pureFunction1"](7,v,i==n.arrowkeyLocation)),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.name," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate5"](" [price: ",e.price,"/",e.unit,"] [stock: ",e.stock,"] [shelf: ",e.shelf,"] [expiry: ",e.expiry,"] ")}}function b(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div",12),s["\u0275\u0275elementStart"](1,"ul",13),s["\u0275\u0275template"](2,y,4,9,"li",14),s["\u0275\u0275elementStart"](3,"li",15),s["\u0275\u0275text"](4,"No. of items: "),s["\u0275\u0275elementStart"](5,"input",16),s["\u0275\u0275listener"]("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"](2).num_items=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"](2);s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngForOf",e.objects),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("ngModel",e.num_items)}}function x(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275text"](1," Item not found. Check the spelling. Or "),s["\u0275\u0275elementStart"](2,"a",18),s["\u0275\u0275element"](3,"i",19),s["\u0275\u0275text"](4," click here to add a new product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]())}function w(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div",9),s["\u0275\u0275elementStart"](1,"input",10),s["\u0275\u0275listener"]("keyup",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().keyUp(t)}))("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().param=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](2,g,3,0,"div",5),s["\u0275\u0275template"](3,b,6,2,"div",11),s["\u0275\u0275template"](4,x,5,0,"div",5),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngModel",e.param),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.error_search),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.objects.length>0&&e.is_finished_search),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.objects.length<1&&e.is_finished_search)}}let S=(()=>{class e{constructor(e,t,i,n){this.dbService=e,this.notify=t,this.localforage=i,this.authService=n,this.onFinish=new s.EventEmitter,this.btn_text="Select",this.onAdd=new s.EventEmitter,this.type="search",this.show="no",this.param="",this.objects=[],this.selected=null,this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,this.added=[],this.filter_param="",this.filter_results=[],this.local_products=[],this.arrowkeyLocation=0,this.num_items=10,$(".search_results").on("click",(function(){$("#sales_search").focus()}))}ngOnInit(){"list"!=this.type&&"select"!=this.type||this.list()}hideSearchResults(){this.param="",this.objects.length=0,this.is_finished_search=!1}ngOnChanges(){$("#sales_search").focus()}productSelected(){for(let e=0;e<this.objects.length;e++)if(this.objects[e].id==this.select_product){this.onAdd.emit(this.objects[e]);break}}addProduct(){$("#add_product_modal").modal("show")}productAdded(e){e.price=parseFloat(e.price),this.objects.push(e),this.onAdd.emit(e),$("#add_product_modal").modal("hide")}list(){this.is_searching=!0,this.is_finished_search=!1,this.error_search=!1,this.dbService.getData("product/getList",this.authService.current_user).subscribe(e=>{"-1"===e.status?(this.is_searching=!1,this.is_finished_search=!1,this.error_search=!0):(this.objects=e.data,this.filter_results="yes"==this.show?this.objects:[],this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1)},e=>{this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1})}filterlist(){let e=this.filter_param;this.filter_results=null==e||null==e||e.length<1?"yes"==this.show?this.objects:[]:this.objects.filter((function(t){return t.name.toLowerCase().includes(e.toLowerCase())}))}add(e){this.onAdd.emit(e),this.is_finished_search=!1,$("#sales_search").focus(),this.param="",this.objects=[],this.arrowkeyLocation=0}search(){if(""==this.param.trim()||null==this.param||null==this.param)return this.objects=[],void(this.is_finished_search=!1);this.is_searching=!0,this.is_finished_search=!1,this.error_search=!1,this.dbService.getDataWithQuery("product/search",this.authService.current_user,"param="+this.param+"&limit="+this.num_items).subscribe(e=>{"-1"===e.status?(this.is_searching=!1,this.is_finished_search=!1,this.error_search=!0):(this.objects=e.data,this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1,this.selected=null)},e=>{this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1})}localSearch(){this.is_searching=!0,this.localforage.getItem(this.dbService.PRODUCT_LIST_KEY).subscribe(e=>{if(this.local_products=e,this.is_finished_search=!1,this.error_search=!1,this.param.length<1)return this.objects=[],this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,!1;if(null==this.local_products)return this.objects=[],this.notify.failNotification("No Products! Please refresh the page"),this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,!1;var t=this.param.toLowerCase().trim();let i=t.split(" ");var s=this.local_products.filter((function(e){for(let t=0;t<i.length;t++)if(-1==e.name.toLowerCase().indexOf(i[t])&&e.barcode!=i[t])return!1;return!0}));s.sort((function(e,i){let s=e.name.toLowerCase(),n=i.name.toLowerCase();return s.indexOf(t)<n.indexOf(t)?-1:s>n?1:0})),this.objects=s.slice(0,s.length>this.num_items?this.num_items-1:s.length),this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1},e=>{this.notify.failNotification("Failed to get products. Please refresh the page")})}select(e){this.selected=e,this.onFinish.emit(e)}highlightObject(e){this.objects.map(e=>{e.selected=!1}),this.highlightedObject=e,e.selected=!0}keyUp(e){switch(e.keyCode){case 38:0==this.arrowkeyLocation||this.arrowkeyLocation--,$(".search_results").scrollTop(0),$(".search_results").scrollTop($(".select-product-active:first").offset().top-$(".search_results").height()+10),console.log($(".select-product-active:first").offset().top-$(".search_results").height()),this.focusCursor();break;case 40:this.arrowkeyLocation==this.objects.length-1||this.arrowkeyLocation++,$(".search_results").scrollTop(0),$(".search_results").scrollTop($(".select-product-active:first").offset().top-$(".search_results").height()+10),console.log($(".select-product-active:first").offset().top-$(".search_results").height()),this.focusCursor();break;case 13:let e=this.objects[this.arrowkeyLocation];null!=e&&null!=e&&this.add(e);break;case 27:this.hideSearchResults();break;default:this.arrowkeyLocation=0,"offline"==this.dbService.ENVIRONMENT?this.search():this.localSearch()}}focusCursor(){let e=$("#sales_search").val();$("#sales_search").val("").val(e)}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](n.a),s["\u0275\u0275directiveInject"](r.a),s["\u0275\u0275directiveInject"](o.LocalForageService),s["\u0275\u0275directiveInject"](c.a))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-select-product"]],inputs:{btn_text:"btn_text",type:"type",show:"show",timestamp:"timestamp"},outputs:{onFinish:"onFinish",onAdd:"onAdd"},features:[s["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:2,consts:[["class","",4,"ngIf"],["class","focus_search",4,"ngIf"],[1,""],[1,"body"],[1,"btn","btn-inverse","btn-sm",3,"click"],[4,"ngIf"],["name","products",1,"product",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"focus_search"],["autofocus","","autocomplete","off","placeholder","Enter product names or barcode","required","","type","text","id","sales_search","name","search",3,"ngModel","keyup","ngModelChange"],["class","search_results ","id","search_results_list",4,"ngIf"],["id","search_results_list",1,"search_results"],[1,"list-group"],["tabindex","-1","class","list-group-item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"list-group-item"],["type","number","min","10","size","10",3,"ngModel","ngModelChange"],["tabindex","-1",1,"list-group-item",3,"ngClass","click"],["routerLink","/add_product"],[1,"feather","icon-plus"]],template:function(e,t){1&e&&(s["\u0275\u0275template"](0,_,7,3,"div",0),s["\u0275\u0275template"](1,w,5,4,"div",1)),2&e&&(s["\u0275\u0275property"]("ngIf","select"==t.type),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf","search"==t.type))},directives:[a.j,l.a,h.l,h.d,h.g,a.i,h.h,h.m,h.a,h.k,h.i,a.h,d.e],styles:[".link[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline}"]}),e})()},hiAm:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("fXoL");let n=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"fa","fa-spin","fa-spinner"]],template:function(e,t){1&e&&(s["\u0275\u0275element"](0,"i",0),s["\u0275\u0275text"](1," Loading..."))},styles:[""]}),e})()},iCyY:function(e,t,i){"use strict";i.r(t),i.d(t,"ViewProductHistoryModule",(function(){return v}));var s=i("ofXK"),n=i("tyNb"),r=i("fXoL"),o=i("1VJT"),c=i("c92J"),a=i("ccyI"),l=i("4j6H"),h=i("thd7");function d(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div"),r["\u0275\u0275text"](1," Type the name of the item and select it. "),r["\u0275\u0275element"](2,"br"),r["\u0275\u0275elementStart"](3,"app-select-product",6),r["\u0275\u0275listener"]("onAdd",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().productSelected(t)})),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}2&e&&(r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("type","search"))}function u(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"h5"),r["\u0275\u0275text"](1),r["\u0275\u0275elementEnd"]()),2&e){const e=r["\u0275\u0275nextContext"](2);r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate1"](" ",e.object.name," ")}}function p(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div",7),r["\u0275\u0275elementStart"](1,"div",8),r["\u0275\u0275template"](2,u,2,1,"h5",4),r["\u0275\u0275elementStart"](3,"button",9),r["\u0275\u0275listener"]("click",(function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().cancel()})),r["\u0275\u0275text"](4,"Cancel"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](5,"div",10),r["\u0275\u0275element"](6,"app-product-history",11),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",null!=e.object&&null!=e.object),r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("id",e.id)}}const f=[{path:"",component:(()=>{class e{constructor(e,t,i,s,n){this.notify=e,this.dbService=t,this.router=s,this.authService=n,this.stock_changes=[],this.can_master_edit=!0,this.can_edit=!0,this.error=!1,this.is_loading=!0,this.is_loaded=!1,this.id=i.snapshot.params.id,-1==this.authService.current_user.permissions.indexOf("View Inventory")&&(this.notify.failNotification("You are not permitted to view that page"),this.goBack()),this.dbService.setTitle(" Product History")}ngOnInit(){null!=this.id&&this.getobject()}getobject(){this.dbService.getDataWithQuery("product/findById",this.authService.current_user,"id="+this.id).subscribe(e=>{this.object=e.data,this.is_loading=!1,this.is_loaded=!0,this.error=!1},e=>{this.is_loading=!1,this.error=!0,this.is_loaded=!1})}goBack(){window.history.back()}productSelected(e){this.router.navigate(["/product_history/"+e.id])}cancel(){this.router.navigate(["/product_history"])}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](o.a),r["\u0275\u0275directiveInject"](c.a),r["\u0275\u0275directiveInject"](n.a),r["\u0275\u0275directiveInject"](n.d),r["\u0275\u0275directiveInject"](a.a))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-view-product-history"]],decls:8,vars:2,consts:[[1,"content"],[1,"container"],[1,"row"],[1,"col-12"],[4,"ngIf"],["class","card",4,"ngIf"],[3,"type","onAdd"],[1,"card"],[1,"card-header"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"card-body"],[3,"id"]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"section",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275elementStart"](2,"div",2),r["\u0275\u0275elementStart"](3,"div",3),r["\u0275\u0275elementStart"](4,"h5"),r["\u0275\u0275text"](5,"Product History"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](6,d,4,1,"div",4),r["\u0275\u0275template"](7,p,7,2,"div",5),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275advance"](6),r["\u0275\u0275property"]("ngIf",null==t.id),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",null!=t.id&&null!=t.id))},directives:[s.j,l.a,h.a],styles:[""]}),e})()}];let m=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[n.f.forChild(f)],n.f]}),e})();var _=i("nEHF"),g=i("nBlB");let v=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[s.b,m,_.a,g.a]]}),e})()},mS1k:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(){}}},nBlB:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("ofXK"),n=i("nEHF"),r=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[s.b,n.a]]}),e})()}}]);