function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,a=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){l=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"9EpT":function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return o}));var i=n("fXoL"),r=["bcElement"],a=n("YsXA"),l=function(){var e=function(){function e(t){_classCallCheck(this,e),this.renderer=t,this.elementType="svg",this.cssClass="barcode",this.format="CODE128",this.lineColor="#000000",this.width=2,this.height=100,this.displayValue=!1,this.fontOptions="",this.font="monospace",this.textAlign="center",this.textPosition="bottom",this.textMargin=2,this.fontSize=20,this.background="#ffffff",this.margin=10,this.marginTop=10,this.marginBottom=10,this.marginLeft=10,this.marginRight=10,this.value="",this.valid=function(){return!0}}return _createClass(e,[{key:"ngOnChanges",value:function(){this.createBarcode()}},{key:"createBarcode",value:function(){if(this.value){var e;switch(this.elementType){case"img":e=this.renderer.createElement("img");break;case"canvas":e=this.renderer.createElement("canvas");break;case"svg":default:e=this.renderer.createElement("svg","svg")}a(e,this.value,this.options);var t,n=_createForOfIteratorHelper(this.bcElement.nativeElement.childNodes);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.renderer.removeChild(this.bcElement.nativeElement,i)}}catch(r){n.e(r)}finally{n.f()}this.renderer.appendChild(this.bcElement.nativeElement,e)}}},{key:"options",get:function(){return{format:this.format,lineColor:this.lineColor,width:this.width,height:this.height,displayValue:this.displayValue,fontOptions:this.fontOptions,font:this.font,textAlign:this.textAlign,textPosition:this.textPosition,textMargin:this.textMargin,fontSize:this.fontSize,background:this.background,margin:this.margin,marginTop:this.marginTop,marginBottom:this.marginBottom,marginLeft:this.marginLeft,marginRight:this.marginRight,valid:this.valid}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.Renderer2))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-barcode6"]],viewQuery:function(e,t){var n;1&e&&i["\u0275\u0275staticViewQuery"](r,!0),2&e&&i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(t.bcElement=n.first)},inputs:{elementType:["bc-element-type","elementType"],cssClass:["bc-class","cssClass"],format:["bc-format","format"],lineColor:["bc-line-color","lineColor"],width:["bc-width","width"],height:["bc-height","height"],displayValue:["bc-display-value","displayValue"],fontOptions:["bc-font-options","fontOptions"],font:["bc-font","font"],textAlign:["bc-text-align","textAlign"],textPosition:["bc-text-position","textPosition"],textMargin:["bc-text-margin","textMargin"],fontSize:["bc-font-size","fontSize"],background:["bc-background","background"],margin:["bc-margin","margin"],marginTop:["bc-margin-top","marginTop"],marginBottom:["bc-margin-bottom","marginBottom"],marginLeft:["bc-margin-left","marginLeft"],marginRight:["bc-margin-right","marginRight"],value:["bc-value","value"],valid:["bc-valid","valid"]},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:2,consts:[["bcElement",""]],template:function(e,t){1&e&&i["\u0275\u0275element"](0,"div",null,0),2&e&&i["\u0275\u0275classMap"](t.cssClass)},encapsulation:2}),e}(),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[]]}),e}()},dtn8:function(e,t,n){"use strict";n.r(t),n.d(t,"AddPurchaseModule",(function(){return Y}));var i=n("ofXK"),r=n("nEHF"),a=n("wDHj"),l=n("tyNb"),o=n("fXoL"),s=n("sGMU"),d=n("mS1k"),c=n("n+He"),m=n("5G6A"),u=n("YrVD"),h=n("c92J"),p=n("I/3d"),f=n("1VJT"),g=n("bgkY"),v=n("eJvr"),_=n("ccyI"),y=n("4j6H"),b=n("3Pt+"),S=n("KIc4"),x=n("/9/o"),w=n("gkiK");function E(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"tr"),o["\u0275\u0275elementStart"](1,"td"),o["\u0275\u0275text"](2),o["\u0275\u0275element"](3,"br"),o["\u0275\u0275elementStart"](4,"button",47),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"]().editItem(e)})),o["\u0275\u0275element"](5,"i",48),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](6,"button",49),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"]().removeItem(e)})),o["\u0275\u0275element"](7,"i",50),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"td"),o["\u0275\u0275text"](9),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](10,"td"),o["\u0275\u0275text"](11),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](12,"td"),o["\u0275\u0275text"](13),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](14,"td"),o["\u0275\u0275text"](15),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](16,"td"),o["\u0275\u0275text"](17),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](18,"td"),o["\u0275\u0275text"](19),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](20,"td"),o["\u0275\u0275text"](21),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](22,"td"),o["\u0275\u0275text"](23),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](24,"td"),o["\u0275\u0275text"](25),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](26,"td"),o["\u0275\u0275text"](27),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,r=t.index;o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",r+1," "),o["\u0275\u0275advance"](7),o["\u0275\u0275textInterpolate"](i.product_name),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",i.stock," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.quantity," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"](i.unit),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.price," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"]((i.price*i.quantity).toFixed(2)),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.markup," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.selling_price," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"](i.expiry),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"](i.description)}}function k(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"button",51),o["\u0275\u0275listener"]("click",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().saveItems()})),o["\u0275\u0275text"](1,"Save"),o["\u0275\u0275elementEnd"]()}}function C(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"button",51),o["\u0275\u0275listener"]("click",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().saveItemsFirestore()})),o["\u0275\u0275text"](1,"Save"),o["\u0275\u0275elementEnd"]()}}function I(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"h5"),o["\u0275\u0275text"](1),o["\u0275\u0275element"](2,"br"),o["\u0275\u0275elementEnd"]()),2&e){var n=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate1"](" ",n.new_item.name,"")}}function M(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"option",64),o["\u0275\u0275text"](1),o["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;o["\u0275\u0275propertyInterpolate"]("value",n),o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate"](n)}}function q(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"table",52),o["\u0275\u0275elementStart"](1,"tr"),o["\u0275\u0275elementStart"](2,"td"),o["\u0275\u0275elementStart"](3,"label"),o["\u0275\u0275text"](4,"Current Stock"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"td"),o["\u0275\u0275text"](6),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"tr"),o["\u0275\u0275elementStart"](8,"td"),o["\u0275\u0275elementStart"](9,"label"),o["\u0275\u0275text"](10,"Quantity"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"td"),o["\u0275\u0275elementStart"](12,"input",53),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_quantity=e}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().checkNumberField()})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](13,"tr"),o["\u0275\u0275elementStart"](14,"td"),o["\u0275\u0275elementStart"](15,"label"),o["\u0275\u0275text"](16,"Unit Cost"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](17,"td"),o["\u0275\u0275elementStart"](18,"input",54),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_price=e}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("keyup",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](19,"tr"),o["\u0275\u0275elementStart"](20,"td"),o["\u0275\u0275elementStart"](21,"label"),o["\u0275\u0275text"](22,"Unit"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](23,"td"),o["\u0275\u0275elementStart"](24,"input",55),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_unit=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](25,"datalist",56),o["\u0275\u0275template"](26,M,2,2,"option",57),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](27,"tr"),o["\u0275\u0275elementStart"](28,"td"),o["\u0275\u0275elementStart"](29,"label"),o["\u0275\u0275text"](30,"Expiry date"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](31,"td"),o["\u0275\u0275elementStart"](32,"input",58),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_expiry=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](33,"tr"),o["\u0275\u0275elementStart"](34,"td"),o["\u0275\u0275elementStart"](35,"label"),o["\u0275\u0275text"](36,"Markup"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](37,"td"),o["\u0275\u0275elementStart"](38,"input",59),o["\u0275\u0275listener"]("blur",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("keyup",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_markup=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](39,"tr"),o["\u0275\u0275elementStart"](40,"td"),o["\u0275\u0275elementStart"](41,"label"),o["\u0275\u0275text"](42,"Selling Price"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](43,"td"),o["\u0275\u0275elementStart"](44,"input",60),o["\u0275\u0275listener"]("focus",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewMarkup()}))("keyup",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewMarkup()}))("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_selling_price=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](45,"tr"),o["\u0275\u0275elementStart"](46,"td"),o["\u0275\u0275elementStart"](47,"label",61),o["\u0275\u0275text"](48," Functional Group "),o["\u0275\u0275element"](49,"i",62),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](50,"td"),o["\u0275\u0275elementStart"](51,"app-select-functional-group",63),o["\u0275\u0275listener"]("onFinish",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().groupSelected(e)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](6),o["\u0275\u0275textInterpolate1"]("",i.new_stock," "),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_quantity),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_price),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_unit),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngForOf",i.units),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_expiry),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_markup),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_selling_price),o["\u0275\u0275advance"](7),o["\u0275\u0275property"]("selected",i.new_description)("type","datalist")}}function N(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"option",64),o["\u0275\u0275text"](1),o["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;o["\u0275\u0275propertyInterpolate"]("value",n),o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate"](n)}}function T(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"input",75),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"](2).new_unit=e})),o["\u0275\u0275elementEnd"]()}if(2&e){var i=o["\u0275\u0275nextContext"](2);o["\u0275\u0275property"]("ngModel",i.new_unit)}}function V(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"tr"),o["\u0275\u0275elementStart"](1,"td"),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"td"),o["\u0275\u0275text"](4),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"td"),o["\u0275\u0275text"](6),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"td"),o["\u0275\u0275text"](8),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"td"),o["\u0275\u0275elementStart"](10,"a",76),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).removeBatchItem(e)})),o["\u0275\u0275element"](11,"i",50),o["\u0275\u0275elementEnd"](),o["\u0275\u0275text"](12," \xa0 "),o["\u0275\u0275elementStart"](13,"a",77),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).editBatchItem(e)})),o["\u0275\u0275element"](14,"i",48),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.batch_number," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.quantity," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.expiry," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"](" ",i.barcode," ")}}function F(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"table",52),o["\u0275\u0275elementStart"](1,"tr"),o["\u0275\u0275elementStart"](2,"td"),o["\u0275\u0275elementStart"](3,"label"),o["\u0275\u0275text"](4,"Current Stock"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"td"),o["\u0275\u0275text"](6),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"tr"),o["\u0275\u0275elementStart"](8,"td"),o["\u0275\u0275elementStart"](9,"label"),o["\u0275\u0275text"](10,"Unit Cost"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"td"),o["\u0275\u0275elementStart"](12,"input",65),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_price=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](13,"tr"),o["\u0275\u0275elementStart"](14,"td"),o["\u0275\u0275elementStart"](15,"label"),o["\u0275\u0275text"](16,"Unit"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](17,"td"),o["\u0275\u0275elementStart"](18,"select",66),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().unit_selected=e})),o["\u0275\u0275template"](19,N,2,2,"option",57),o["\u0275\u0275elementStart"](20,"option",67),o["\u0275\u0275text"](21,"Other"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](22,T,1,1,"input",68),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](23,"tr"),o["\u0275\u0275elementStart"](24,"td",69),o["\u0275\u0275elementStart"](25,"tr"),o["\u0275\u0275elementStart"](26,"th"),o["\u0275\u0275text"](27,"Batch Number"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](28,"th"),o["\u0275\u0275text"](29,"Quantity"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](30,"th"),o["\u0275\u0275text"](31,"Expiry"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](32,"th"),o["\u0275\u0275text"](33,"Barcode"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275element"](34,"th"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](35,"tr"),o["\u0275\u0275elementStart"](36,"td"),o["\u0275\u0275elementStart"](37,"input",70),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_batch_item.batch_number=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](38,"td"),o["\u0275\u0275elementStart"](39,"input",71),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_batch_item.quantity=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](40,"td"),o["\u0275\u0275elementStart"](41,"input",72),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_batch_item.expiry=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](42,"td"),o["\u0275\u0275elementStart"](43,"input",73),o["\u0275\u0275listener"]("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_batch_item.barcode=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](44,"td"),o["\u0275\u0275elementStart"](45,"a",74),o["\u0275\u0275listener"]("click",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().addToBatchItems()})),o["\u0275\u0275text"](46,"Add"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](47,V,15,4,"tr",9),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](48,"tr"),o["\u0275\u0275elementStart"](49,"td"),o["\u0275\u0275elementStart"](50,"label"),o["\u0275\u0275text"](51,"Total Quantity"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](52,"td"),o["\u0275\u0275text"](53),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](54,"tr"),o["\u0275\u0275elementStart"](55,"td"),o["\u0275\u0275elementStart"](56,"label"),o["\u0275\u0275text"](57,"Markup"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](58,"td"),o["\u0275\u0275elementStart"](59,"input",59),o["\u0275\u0275listener"]("blur",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("keyup",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_markup=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](60,"tr"),o["\u0275\u0275elementStart"](61,"td"),o["\u0275\u0275elementStart"](62,"label"),o["\u0275\u0275text"](63,"Selling Price"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](64,"td"),o["\u0275\u0275elementStart"](65,"input",60),o["\u0275\u0275listener"]("focus",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewPrice()}))("change",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewMarkup()}))("keyup",(function(){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().setNewMarkup()}))("ngModelChange",(function(e){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().new_selling_price=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](6),o["\u0275\u0275textInterpolate1"]("",i.new_stock," "),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_price),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.unit_selected),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngForOf",i.units),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("ngIf","other"==i.unit_selected),o["\u0275\u0275advance"](15),o["\u0275\u0275property"]("ngModel",i.new_batch_item.batch_number),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngModel",i.new_batch_item.quantity),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngModel",i.new_batch_item.expiry),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngModel",i.new_batch_item.barcode),o["\u0275\u0275advance"](4),o["\u0275\u0275property"]("ngForOf",i.batch_items),o["\u0275\u0275advance"](6),o["\u0275\u0275textInterpolate1"]("",i.new_quantity," "),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_markup),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",i.new_selling_price)}}function P(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"span"),o["\u0275\u0275text"](1,"No held items"),o["\u0275\u0275elementEnd"]())}var O=function(e){return{"table-primary":e}};function j(e,t){if(1&e){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"tr",83),o["\u0275\u0275listener"]("dblclick",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).unhold(e)}))("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).selectHeldItem(e)})),o["\u0275\u0275elementStart"](1,"td"),o["\u0275\u0275text"](2),o["\u0275\u0275elementStart"](3,"button",84),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](n);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).deleteHeld(e)})),o["\u0275\u0275element"](4,"i",50),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"td"),o["\u0275\u0275text"](6),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"td"),o["\u0275\u0275text"](8),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"td"),o["\u0275\u0275text"](10),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,r=t.index,a=o["\u0275\u0275nextContext"](2);o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](5,O,a.selectedHeldItem==i)),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",r+1," "),o["\u0275\u0275advance"](4),o["\u0275\u0275textInterpolate1"]("",i.user," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",i.time," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",i.items.length," ")}}function A(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"tr"),o["\u0275\u0275elementStart"](1,"td"),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"td"),o["\u0275\u0275text"](4),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",n.product_name," "),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",n.quantity," ")}}function H(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"table",79),o["\u0275\u0275elementStart"](1,"thead"),o["\u0275\u0275elementStart"](2,"tr"),o["\u0275\u0275elementStart"](3,"th"),o["\u0275\u0275text"](4,"Item"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"th"),o["\u0275\u0275text"](6,"Quantity"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"tbody"),o["\u0275\u0275template"](8,A,5,2,"tr",9),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){var n=o["\u0275\u0275nextContext"](2);o["\u0275\u0275advance"](8),o["\u0275\u0275property"]("ngForOf",n.selectedHeldItem.items)}}function B(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",2),o["\u0275\u0275elementStart"](1,"div",78),o["\u0275\u0275elementStart"](2,"table",79),o["\u0275\u0275elementStart"](3,"thead"),o["\u0275\u0275elementStart"](4,"tr"),o["\u0275\u0275elementStart"](5,"th"),o["\u0275\u0275text"](6,"#"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"th"),o["\u0275\u0275text"](8,"Saved by"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"th"),o["\u0275\u0275text"](10,"Date"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"th"),o["\u0275\u0275text"](12,"Num. Items"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](13,"tbody"),o["\u0275\u0275template"](14,j,11,7,"tr",80),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](15,"div",81),o["\u0275\u0275template"](16,H,9,1,"table",82),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){var n=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](14),o["\u0275\u0275property"]("ngForOf",n.held_items),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngIf",null!=n.selectedHeldItem)}}var L,D,Q,J=[{path:"",component:(L=function(){function e(t,n,i,r,a,l,d,c){_classCallCheck(this,e),this.dbService=t,this.router=n,this.firestore=i,this.notify=r,this.socket=a,this.localforage=l,this.authService=d,this.ar=c,this.title="Receive Purchased Items",this.error=!1,this.is_loading=!0,this.is_loaded=!1,this.onFinish=new o.EventEmitter,this.url="purchase/findById",this.items=[],this.new_item=null,this.new_quantity=null,this.new_price=null,this.purchase_total=0,this.total_selling=0,this.difference=0,this.units=["ampoule","bottle","box","capsule","carton","glove","inhaler","pack","pessary","piece","roll","strip","suppository","syringe","tablet","tube","vial"],this.unit_selected="",this.general_markup=1.33,this.held_items=[],this.selectedHeldItem=null,this.entry_mode="single",this.batch_items=[],this.user_type="staff",this.vendor_id="",this.editing=!1,this.session_id="",this.editing_item=null,this.user_type=this.authService.current_user.type,this.id=c.snapshot.params.id,this.session_id=this.dbService.getToday("timestamp"),null!=this.id&&null!=this.id||(this.purchase=new s.a,this.purchase.createdAt=this.dbService.getToday()),-1==this.authService.current_user.permissions.indexOf("Receive Purchases")&&(this.notify.failNotification("You are not permitted to view the page"),this.dbService.goBackHome()),this.dbService.setTitle("Receive Purchase"),this.units=this.dbService.units,this.new_batch_item=new u.a}return _createClass(e,[{key:"ngOnInit",value:function(){this.ts=this.dbService.getToday(),null!=localStorage.getItem("markup")&&(this.general_markup=parseFloat(localStorage.getItem("markup"))),null==this.id||null==this.id||(this.editing=!0,this.title="Edit Purchase Invoice",this.getObject()),this.held_items=JSON.parse(localStorage.getItem("purchase_heldItems")),null==this.held_items&&(this.held_items=[])}},{key:"getObject",value:function(){var e=this;this.dbService.getDataWithQuery(this.url,this.authService.current_user,"id="+this.id).subscribe((function(t){e.purchase=t.data,e.purchase.createdAt=t.data.date,e.vendor_id=t.data.vendor.id,e.items=t.details,e.is_loading=!1,e.is_loaded=!0,e.error=!1,e.getTotal()}),(function(t){e.is_loading=!1,e.error=!0,e.is_loaded=!1}))}},{key:"vendorSelected",value:function(e){this.purchase.vendor=e,this.selected_vendor_id=e.id,console.log(e)}},{key:"trackBy",value:function(e,t){return t.product._id}},{key:"productSelected",value:function(e){this.inList(e)?this.notify.failNotification("Item already in the list"):(this.new_item=e,this.new_quantity="",this.new_expiry=e.expiry,this.new_price=e.cost_price,this.new_selling_price=e.price,this.unit_selected=e.unit,this.new_unit=e.unit,this.new_stock=e.stock,this.new_markup=e.markup,this.new_description=e.description,$("#enter_purchase_quantity_modal").modal({backdrop:"static",keyboard:!1}),$("#enter_purchase_quantity_modal").on("shown.bs.modal",(function(){$("#qtt").focus()})))}},{key:"inList",value:function(e){for(var t=!1,n=0;n<this.items.length;n++)if(this.items[n].product_id==e.id){t=!0;break}return t}},{key:"groupSelected",value:function(e){this.new_description=e}},{key:"editItem",value:function(e){this.new_item=e.product,this.editing_item=Object.assign({},e),this.new_item=e.product,this.new_quantity=e.quantity,this.new_price=e.price,this.new_expiry=e.expiry,this.new_unit=e.unit,this.new_markup=e.markup,this.new_selling_price=e.selling_price,this.new_description=e.description,this.batch_items=null==e.batch_items||null==e.batch_items?[]:e.batch_items,$("#enter_purchase_quantity_modal").modal({backdrop:"static",keyboard:!1})}},{key:"scrollToBottom",value:function(){var e=Math.max($("#purchases_table").height()-$(".purchase_sales_items").height()+40,0);$(".purchase_sales_items").scrollTop(e),console}},{key:"addItem",value:function(){var e=this;if("multiple"==this.entry_mode&&this.batch_items.length<1)return alert("Please add at least one batch and expiry. Enter the batch number, expiry, and quantity and then click the Add button .\n      . Otherwise choose the 'Single Entry Mode' if you just want to enter a single quantity."),!1;var t=this.inList(this.new_item),n=new c.a;if(n.product_name=this.new_item.name,n.product_id=this.new_item.id,n.markup=this.new_markup,n.price=this.new_price,n.quantity=this.new_quantity,n.total=this.new_quantity*this.new_price,n.selling_price=this.new_selling_price,n.expiry=this.new_expiry,n.product=this.new_item,n.stock=this.new_stock,n.batch_items=this.batch_items,n.description=this.new_description,n.unit=this.new_unit,t){for(var i=0;i<this.items.length;i++)if(this.items[i].product_id==this.new_item.id){this.items[i]=Object.assign({},n);break}}else this.items.push(n);this.new_item=new d.a,this.new_quantity=null,this.new_price=null,this.new_item=null,this.new_expiry="",this.new_markup=null,this.new_selling_price=null,this.new_unit=null,this.new_description=null,this.batch_items=[],this.getTotal(),this.holdItems(!1),$("#enter_purchase_quantity_modal").modal("hide"),this.ts=this.dbService.getToday("timestamp_string"),setTimeout((function(){e.scrollToBottom()}),1e3)}},{key:"resetMarkup",value:function(){var e=this;this.items.map((function(t){t.markup=e.general_markup}))}},{key:"addNewProduct",value:function(){$("#add_new_product_modal").modal({backdrop:"static",keyboard:!1}),$("#add_new_product_modal").on("shown.bs.modal",(function(){$("#product_form_name").focus()}))}},{key:"setMarkup",value:function(e){e.markup=(parseFloat(e.selling_price)/parseFloat(e.price)).toFixed(2)}},{key:"setSellingPrice",value:function(e){e.selling_price=(parseFloat(e.markup)*parseFloat(e.price)).toFixed(2)}},{key:"setNewMarkup",value:function(){if(isNaN(this.new_selling_price))return alert("Only numbers allowed for the prices"),void(this.new_selling_price="");this.new_markup=(this.new_selling_price/parseFloat(this.new_price)).toFixed(2)}},{key:"removeItem",value:function(e){this.items.splice(this.items.indexOf(e),1),this.getTotal(),this.ts=this.dbService.getToday("timestamp_string")}},{key:"changeQuantity",value:function(e){var t=window.prompt("Enter new quantity");null!=t&&""!=t.trim()&&null!=t&&(e.quantity=parseFloat(t)),this.getTotal()}},{key:"changePrice",value:function(e){var t=window.prompt("Enter new price");null!=t&&""!=t.trim()&&null!=t&&(e.price=parseFloat(t)),this.getTotal()}},{key:"changeMarkup",value:function(e){var t=window.prompt("Enter new markup");null!=t&&""!=t.trim()&&null!=t&&(e.markup=parseFloat(t))}},{key:"getTotal",value:function(){var e=0,t=0;this.items.map((function(n){e+=n.quantity*n.price,t+=n.quantity*n.selling_price})),this.purchase_total=e.toFixed(2),this.total_selling=t.toFixed(2),this.difference=(t-e).toFixed(2)}},{key:"setQuantities",value:function(){var e=0,t=this;$(".quantities").each((function(){t.items[e].quantity=$(this).val(),e++})),this.getTotal()}},{key:"setPrices",value:function(){var e=0,t=this;$(".prices").each((function(){t.items[e].price=$(this).val(),t.setSellingPrice(t.items[e]),e++})),this.getTotal()}},{key:"setMarkups",value:function(){var e=0,t=this;$(".markups").each((function(){t.items[e].markup=$(this).val(),e++})),this.getTotal()}},{key:"setSellingPrices",value:function(){var e=0,t=this;$(".selling_prices").each((function(){t.items[e].selling_price=$(this).val(),e++})),this.getTotal()}},{key:"saveItems",value:function(){var e=this;if(null==this.items||null==this.items||this.items.length<1)return this.notify.failNotification("Please add at least one product"),!1;if(null==this.purchase.vendor||null==this.purchase.vendor)return this.notify.failNotification("Please select a vendor"),!1;this.notify.showLoading();for(var t=[],n=[],i=[],r=[],a=[],l=[],o=[],s=[],d=[],c="RP-"+this.dbService.getToday("timestamp_string"),m=function(c){var m=e.items[c];t.push(m.product_id),n.push(m.price),i.push(m.quantity),a.push(m.markup),r.push(m.unit),l.push(m.selling_price),o.push(m.expiry),d.push(m.description);try{m.batch_items.map((function(e){e.product=m.product_id,s.push(e)}))}catch(u){}},u=0;u<this.items.length;u++)m(u);var h=new FormData;h.append("products",t.join("||")),h.append("prices",n.join("||")),h.append("quantities",i.join("||")),h.append("units",r.join("||")),h.append("expiries",o.join("||")),h.append("markups",a.join("||")),h.append("selling_prices",l.join("||")),h.append("descriptions",d.join("||")),h.append("created_by",this.authService.current_user.id),h.append("update_prices","yes"),h.append("payment_method",this.payment_method),h.append("amount_paid",this.amount_paid),h.append("batch_details",JSON.stringify(s)),h.append("vendor",this.purchase.vendor.id),h.append("delivery_point",this.purchase.site),h.append("invoice",this.purchase.invoice),h.append("code",c),h.append("date",this.purchase.createdAt),h.append("created_on",this.dbService.getToday("timestamp")),h.append("vendor_name",this.purchase.vendor.name),h.append("display_name",this.authService.current_user.display_name);var p=this.editing?"edit":"saveBulk";this.editing&&h.append("id",this.id),this.dbService.postData(h,"purchase/".concat(p),this.authService.current_user).subscribe((function(t){e.notify.hideLoading(),"0"===t.status?e.notify.failNotification("Unable to authenticate. Please login again"):"-1"===t.status?e.notify.failNotification("Server error. Please try again"):"-9"===t.status?e.notify.showNotification("You are not permitted to perform this action","fail",3e3):(e.notify.hideLoading(),e.items=[],e.purchase.invoice="",e.clearCurrentSession(),e.getTotal(),e.notify.successNotification("Purchases saved successfully"),$("#make_payment_modal").modal("show"))}),(function(t){e.notify.hideLoading(),e.notify.noConnectionNotification()})),this.ts=this.dbService.getToday("timestamp_string")}},{key:"checkNumberField",value:function(){if(isNaN(this.new_quantity))return alert("Only numbers allowed for the quantity, prices and markup"),void(this.new_quantity="")}},{key:"setNewPrice",value:function(){if(!this.dbService.isEmpty(this.new_price)){if(isNaN(this.new_price))return alert("Only numbers allowed for the prices and markup"),void(this.new_price="");this.new_selling_price=(this.new_price*this.new_markup).toFixed(2)}}},{key:"productAdded",value:function(e){$("#add_new_product_modal").modal("hide"),this.productSelected(e)}},{key:"ngOnDestroy",value:function(){this.items.length>0&&(this.holdItems(!0),this.notify.successNotification("Receipt held automatically"))}},{key:"clearCurrentSession",value:function(){for(var e=0;e<this.held_items.length;e++){var t=this.held_items[e];if(this.held_items[e].id==this.session_id){this.held_items.splice(this.held_items.indexOf(t),1),localStorage.setItem("purchase_heldItems",JSON.stringify(this.held_items));break}}}},{key:"holdItems",value:function(e){var t=new m.a;this.clearCurrentSession(),t.items=this.items,t.id=this.session_id,t.user=this.authService.current_user.display_name,t.time=this.dbService.getToday("timestamp"),this.held_items.push(t),localStorage.setItem("purchase_heldItems",JSON.stringify(this.held_items)),e?(this.items=[],this.session_id=this.dbService.getToday("timestamp")):this.notify.successNotification("Items held"),this.getTotal()}},{key:"viewHeldItems",value:function(){$("#purchase_held_items_modal").modal({backdrop:"static",keyboard:!1}),this.held_items.length>0&&(this.selectedHeldItem=this.held_items[0])}},{key:"selectHeldItem",value:function(e){this.selectedHeldItem=e}},{key:"unhold",value:function(e){this.items=e.items,this.held_items.splice(this.held_items.indexOf(e),1),localStorage.setItem("purchase_heldItems",JSON.stringify(this.held_items)),$("#purchase_held_items_modal").modal("hide"),this.getTotal()}},{key:"deleteHeld",value:function(e){window.confirm("Sure?")&&(this.held_items.splice(this.held_items.indexOf(e),1),localStorage.setItem("purchase_heldItems",JSON.stringify(this.held_items)))}},{key:"unholdSelected",value:function(){this.unhold(this.selectedHeldItem)}},{key:"clearHeldItems",value:function(){window.confirm("Are you sure?")&&(localStorage.removeItem("purchase_heldItems"),this.selectedHeldItem=null,this.held_items=[],$("#held_items_modal").modal("hide"))}},{key:"addToBatchItems",value:function(){var e=this;if(isNaN(this.new_batch_item.quantity))return alert("Only numbers allowed for quantity"),!1;this.batch_items.push(this.new_batch_item),this.new_quantity=0,this.new_batch_item=new u.a,this.batch_items.map((function(t){e.new_quantity+=parseInt(t.quantity)}))}},{key:"removeBatchItem",value:function(e){var t=this;this.batch_items.splice(this.batch_items.indexOf(e),1),this.new_quantity=0,this.new_batch_item=new u.a,this.batch_items.map((function(e){t.new_quantity+=parseInt(e.quantity)}))}},{key:"editBatchItem",value:function(e){var t=this;this.batch_items.splice(this.batch_items.indexOf(e),1),this.new_quantity=0,this.new_batch_item=e,this.batch_items.map((function(e){t.new_quantity+=parseInt(e.quantity)}))}},{key:"cancel",value:function(){this.items=[],this.getTotal()}},{key:"goBack",value:function(){window.history.back()}},{key:"goToPayment",value:function(){$("#make_payment_modal").modal("hide"),this.router.navigate(["/add_purchase_payment"],{queryParams:{recipient:this.selected_vendor_id}})}},{key:"saveItemsFirestore",value:function(){var e=this;if(null==this.items||null==this.items||this.items.length<1)return this.notify.failNotification("Please add at least one product"),!1;if(null==this.purchase.vendor||null==this.purchase.vendor)return this.notify.failNotification("Please select a vendor"),!1;this.notify.showLoading();var t=[],n=[],i=[],r=[],a=[],l=[],o=[],s=[];this.dbService.getToday("timestamp_string");for(var d=function(d){var c=e.items[d];t.push(c.product_id),n.push(c.price),i.push(c.quantity),a.push(c.markup),r.push(c.unit),l.push(c.selling_price),o.push(c.expiry),c.batch_items.map((function(e){e.product=c.product_id,s.push(e)}))},c=0;c<this.items.length;c++)d(c);var m={status:"Pending"};new FormData,m.products=t.join("||"),m.prices=n.join("||"),m.quantities=i.join("||"),m.units=r.join("||"),m.expiries=o.join("||"),m.markups=a.join("||"),m.selling_prices=l.join("||"),m.created_by=this.authService.current_user.id,m.update_prices="yes",m.batch_details=JSON.stringify(s),m.vendor=this.purchase.vendor.id,m.invoice=this.purchase.invoice,m.date=this.purchase.createdAt,m.created_on=this.dbService.getToday("timestamp"),m.vendor_name=this.purchase.vendor.name,m.display_name=this.authService.current_user.display_name,m.company_id=this.authService.current_user.company_id,this.firestore.collection("remote_purchases").add(m).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),this.notify.hideLoading(),this.items=[],this.purchase.invoice="",this.getTotal(),alert("Purchases uploaded successfully. \n      Your database in your facility will be updated immediately if it is online. \n      Else it'll be updated on the next restart if there is internet connection."),this.socket.sendEvent({company_id:this.authService.current_user.company_id,parent_company_id:this.authService.current_user.parent_company,message:"Purchases received. stock and prices updated",event:"purchases_received"})}}]),e}(),L.\u0275fac=function(e){return new(e||L)(o["\u0275\u0275directiveInject"](h.a),o["\u0275\u0275directiveInject"](l.c),o["\u0275\u0275directiveInject"](p.a),o["\u0275\u0275directiveInject"](f.a),o["\u0275\u0275directiveInject"](g.a),o["\u0275\u0275directiveInject"](v.a),o["\u0275\u0275directiveInject"](_.a),o["\u0275\u0275directiveInject"](l.a))},L.\u0275cmp=o["\u0275\u0275defineComponent"]({type:L,selectors:[["app-add-purchase"]],inputs:{id:"id"},outputs:{onFinish:"onFinish"},decls:119,vars:22,consts:[[1,"content"],[1,"container"],[1,"row"],[1,"col-md-3"],[1,"col-md-9"],[3,"live_server","timestamp","type","show","onAdd"],[1,"card"],[1,"card-body","table-responsive","purchase_sales_items"],["id","purchases_table",1,"table","table-striped","table-bordered","table-hover"],[4,"ngFor","ngForOf"],[1,"card","sales-fixed-bottom"],[1,"card-body"],["required","","type","date","name","createdAt",3,"ngModel","ngModelChange"],[3,"select_item","type","onFinish"],["required","","name","invoice",3,"ngModel","ngModelChange"],[1,""],[1,"text-danger"],["title","You can record payment when you save the invoice",1,"badge","badge-info"],[1,"fa","fa-info-cirle"],[1,"btn","btn-danger",3,"click"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-info","btn-sm",3,"disabled","click"],[1,"btn","btn-info","btn-sm",3,"click"],["id","enter_purchase_quantity_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[4,"ngIf"],[1,"modal-body"],["ngNativeValidate","",3,"ngSubmit"],["n","ngForm"],["class","table table-bordered table-striped",4,"ngIf"],["type","submit","name","submit","value","Add Item",1,"btn","btn-success","waves-effect"],["type","button","data-dismiss","modal",1,"btn","btn-warning","waves-effect"],["id","add_new_product_modal","tabindex","-1","role","dialog",1,"modal","fade","in"],["role","document",1,"modal-dialog","modal-lg"],[3,"onFinish"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-danger"],["id","purchase_held_items_modal","tabindex","-1","role","dialog",1,"modal","fade","in"],["class","row",4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-primary","btn-sm",3,"click"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],["type","button","data-dismiss","modal",1,"btn","btn-warning","btn-sm"],["id","make_payment_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],["type","button",1,"btn","btn-success",3,"click"],["type","button","title","edit the markup, quantity, unit price, expiry or selling price of this item",1,"btn","btn-warning","btn-xs",3,"click"],[1,"fa","fa-edit"],["type","button","title","remove item from list",1,"btn","btn-danger","btn-xs",3,"click"],[1,"fa","fa-remove"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"table","table-bordered","table-striped"],["autocomplete","off","type","text","required","","name","new_quantity","id","qtt","placeholder","Quantity",3,"ngModel","ngModelChange","change"],["autocomplete","off","type","text","required","","name","new_price","placeholder","Cost",3,"ngModel","ngModelChange","change","keyup"],["type","text","name","new_unit","list","unit_grouplist",3,"ngModel","ngModelChange"],["id","unit_grouplist"],[3,"value",4,"ngFor","ngForOf"],["required","","type","date","name","expiry",3,"ngModel","ngModelChange"],["autocomplete","off","required","","type","text","name","new_markup",3,"ngModel","blur","change","keyup","ngModelChange"],["autocomplete","off","required","","type","text","name","new_selling_price",3,"ngModel","focus","change","keyup","ngModelChange"],["title","The functional group helps the system suggest alternatives when selling"],[1,"fa","fa-info-circle"],[3,"selected","type","onFinish"],[3,"value"],["autocomplete","off","type","text","required","","name","new_price","placeholder","Cost",3,"ngModel","ngModelChange"],["name","unit",1,"",3,"ngModel","ngModelChange"],["value","other"],["class","form-control","type","text","name","unit",3,"ngModel","ngModelChange",4,"ngIf"],["colspan","2"],["type","text","name","batch_number",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","quantity",1,"form-control",3,"ngModel","ngModelChange"],["type","date","name","expiry",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","barcode",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","text","name","unit",1,"form-control",3,"ngModel","ngModelChange"],[1,"text-danger",3,"click"],[1,"text-primary",3,"click"],[1,"col-7","fixed_height"],[1,"table","table-striped","table-bordered","table-hover"],[3,"ngClass","dblclick","click",4,"ngFor","ngForOf"],[1,"col-5","fixed_height"],["class","table table-striped table-bordered table-hover",4,"ngIf"],[3,"ngClass","dblclick","click"],["type","button","data-dismiss","modal",1,"btn","btn-danger","btn-sm",3,"click"]],template:function(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"section",0),o["\u0275\u0275elementStart"](1,"div",1),o["\u0275\u0275elementStart"](2,"div",2),o["\u0275\u0275elementStart"](3,"div",3),o["\u0275\u0275elementStart"](4,"h5"),o["\u0275\u0275text"](5),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](6,"div",4),o["\u0275\u0275elementStart"](7,"app-select-product",5),o["\u0275\u0275listener"]("onAdd",(function(e){return t.productSelected(e)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"div",6),o["\u0275\u0275elementStart"](9,"div",7),o["\u0275\u0275elementStart"](10,"table",8),o["\u0275\u0275elementStart"](11,"thead"),o["\u0275\u0275elementStart"](12,"tr"),o["\u0275\u0275element"](13,"th"),o["\u0275\u0275elementStart"](14,"th"),o["\u0275\u0275text"](15,"Product"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](16,"th"),o["\u0275\u0275text"](17,"Curr. Stock"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](18,"th"),o["\u0275\u0275text"](19,"Quantity"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](20,"th"),o["\u0275\u0275text"](21,"Unit"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](22,"th"),o["\u0275\u0275text"](23,"Cost"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](24,"th"),o["\u0275\u0275text"](25,"Total"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](26,"th"),o["\u0275\u0275text"](27,"Markup"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](28,"th"),o["\u0275\u0275text"](29,"Selling Price"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](30,"th"),o["\u0275\u0275text"](31,"Expiry"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](32,"th"),o["\u0275\u0275text"](33,"Functional Grp."),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](34,"tbody"),o["\u0275\u0275template"](35,E,28,11,"tr",9),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](36,"div",10),o["\u0275\u0275elementStart"](37,"div",11),o["\u0275\u0275elementStart"](38,"div"),o["\u0275\u0275elementStart"](39,"label"),o["\u0275\u0275text"](40,"Date of Purchase*"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](41,"input",12),o["\u0275\u0275listener"]("ngModelChange",(function(e){return t.purchase.createdAt=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275text"](42," | "),o["\u0275\u0275elementStart"](43,"app-select-vendor",13),o["\u0275\u0275listener"]("onFinish",(function(e){return t.vendorSelected(e)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](44,"label"),o["\u0275\u0275text"](45,"Invoice #"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](46,"input",14),o["\u0275\u0275listener"]("ngModelChange",(function(e){return t.purchase.invoice=e})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](47,"div",15),o["\u0275\u0275elementStart"](48,"b",16),o["\u0275\u0275text"](49),o["\u0275\u0275elementEnd"](),o["\u0275\u0275text"](50," | "),o["\u0275\u0275elementStart"](51,"label",17),o["\u0275\u0275text"](52,"Payment: "),o["\u0275\u0275element"](53,"i",18),o["\u0275\u0275elementEnd"](),o["\u0275\u0275text"](54),o["\u0275\u0275elementStart"](55,"button",19),o["\u0275\u0275listener"]("click",(function(){return t.cancel()})),o["\u0275\u0275text"](56,"Cancel"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](57,k,2,0,"button",20),o["\u0275\u0275template"](58,C,2,0,"button",20),o["\u0275\u0275elementStart"](59,"span",15),o["\u0275\u0275elementStart"](60,"button",21),o["\u0275\u0275listener"]("click",(function(){return t.holdItems(!0)})),o["\u0275\u0275text"](61,"Hold & Clear"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](62,"button",21),o["\u0275\u0275listener"]("click",(function(){return t.holdItems(!1)})),o["\u0275\u0275text"](63,"Hold & Continue"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](64,"button",22),o["\u0275\u0275listener"]("click",(function(){return t.viewHeldItems()})),o["\u0275\u0275text"](65),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](66,"div",23),o["\u0275\u0275elementStart"](67,"div",24),o["\u0275\u0275elementStart"](68,"div",25),o["\u0275\u0275elementStart"](69,"div",26),o["\u0275\u0275template"](70,I,3,1,"h5",27),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](71,"div",28),o["\u0275\u0275elementStart"](72,"form",29,30),o["\u0275\u0275listener"]("ngSubmit",(function(){return t.addItem()})),o["\u0275\u0275template"](74,q,52,10,"table",31),o["\u0275\u0275template"](75,F,66,13,"table",31),o["\u0275\u0275element"](76,"input",32),o["\u0275\u0275elementStart"](77,"button",33),o["\u0275\u0275text"](78,"Cancel"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](79,"div",34),o["\u0275\u0275elementStart"](80,"div",35),o["\u0275\u0275elementStart"](81,"div",25),o["\u0275\u0275elementStart"](82,"div",26),o["\u0275\u0275elementStart"](83,"h5"),o["\u0275\u0275text"](84,"Add new product"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](85,"div",28),o["\u0275\u0275elementStart"](86,"app-product-form",36),o["\u0275\u0275listener"]("onFinish",(function(e){return t.productAdded(e)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](87,"div",37),o["\u0275\u0275elementStart"](88,"button",38),o["\u0275\u0275text"](89,"Cancel"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](90,"div",39),o["\u0275\u0275elementStart"](91,"div",35),o["\u0275\u0275elementStart"](92,"div",25),o["\u0275\u0275elementStart"](93,"div",26),o["\u0275\u0275text"](94," Held Items "),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](95,"div",28),o["\u0275\u0275template"](96,P,2,0,"span",27),o["\u0275\u0275template"](97,B,17,2,"div",40),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](98,"div",37),o["\u0275\u0275elementStart"](99,"button",41),o["\u0275\u0275listener"]("click",(function(){return t.unholdSelected()})),o["\u0275\u0275text"](100,"Unhold Selected"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](101,"button",42),o["\u0275\u0275listener"]("click",(function(){return t.clearHeldItems()})),o["\u0275\u0275text"](102,"Delete All"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](103,"button",43),o["\u0275\u0275text"](104,"Close"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](105,"div",44),o["\u0275\u0275elementStart"](106,"div",45),o["\u0275\u0275elementStart"](107,"div",25),o["\u0275\u0275elementStart"](108,"div",26),o["\u0275\u0275elementStart"](109,"h5"),o["\u0275\u0275text"](110,"Would you like to record payment for this purchase now? "),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](111,"div",28),o["\u0275\u0275elementStart"](112,"b"),o["\u0275\u0275text"](113,"You can always add payment later. Click on the 'Accounts' menu on the left side bar. "),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](114,"div",37),o["\u0275\u0275elementStart"](115,"button",46),o["\u0275\u0275listener"]("click",(function(){return t.goToPayment()})),o["\u0275\u0275text"](116,"Yes"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](117,"button",38),o["\u0275\u0275text"](118,"No, I'll do it later"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e&&(o["\u0275\u0275advance"](5),o["\u0275\u0275textInterpolate1"]("",t.title," "),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("live_server",!0)("timestamp",t.ts)("type","search")("show","no"),o["\u0275\u0275advance"](28),o["\u0275\u0275property"]("ngForOf",t.items),o["\u0275\u0275advance"](6),o["\u0275\u0275property"]("ngModel",t.purchase.createdAt),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("select_item",t.vendor_id)("type","select"),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("ngModel",t.purchase.invoice),o["\u0275\u0275advance"](3),o["\u0275\u0275textInterpolate1"]("Total: ",t.purchase_total,""),o["\u0275\u0275advance"](5),o["\u0275\u0275textInterpolate1"](" Profit: ",t.difference," "),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("ngIf","staff"==t.user_type),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","admin"==t.user_type),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("disabled",t.items.length<1),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("disabled",t.items.length<1),o["\u0275\u0275advance"](3),o["\u0275\u0275textInterpolate1"]("Held Items (",t.held_items.length,")"),o["\u0275\u0275advance"](5),o["\u0275\u0275property"]("ngIf",null!=t.new_item),o["\u0275\u0275advance"](4),o["\u0275\u0275property"]("ngIf","single"==t.entry_mode),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","multiple"==t.entry_mode),o["\u0275\u0275advance"](21),o["\u0275\u0275property"]("ngIf",t.held_items.length<1),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",t.held_items.length>0))},directives:[y.a,i.i,b.b,b.l,b.e,b.h,S.a,i.j,b.f,b.g,x.a,w.a,b.i,b.n,b.m,i.h],styles:[""]}),L)}],R=((D=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:D}),D.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||D)},imports:[[l.f.forChild(J)],l.f]}),D),U=n("nBlB"),Y=((Q=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:Q}),Q.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Q)},imports:[[i.b,R,r.a,a.a,U.a]]}),Q)},nBlB:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("ofXK"),r=n("nEHF"),a=n("9EpT"),l=n("fXoL"),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=l["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.b,r.a,a.b]]}),e}()},wDHj:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("ofXK"),r=n("nEHF"),a=n("6QD7"),l=n("fXoL"),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=l["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=l["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.b,r.a,a.b],a.b]}),e}()}}]);