function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{SqMz:function(e,t,n){"use strict";n.r(t),n.d(t,"ProductDetailsModule",(function(){return F}));var a=n("ofXK"),i=n("tyNb"),s=n("fXoL"),o=n("c92J"),r=n("1VJT"),l=n("ccyI"),d=n("thd7"),c=n("6CxU"),u=n("hiAm"),m=n("STgK"),f=n("rfqN");function h(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function p(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",43),s["\u0275\u0275elementStart"](1,"table",44),s["\u0275\u0275elementStart"](2,"tr"),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275text"](4,"Name"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"td"),s["\u0275\u0275text"](6),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"tr"),s["\u0275\u0275elementStart"](8,"td"),s["\u0275\u0275text"](9,"Category"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](10,"td"),s["\u0275\u0275text"](11),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](12,"tr"),s["\u0275\u0275elementStart"](13,"td"),s["\u0275\u0275text"](14,"Current Stock"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](15,"td"),s["\u0275\u0275text"](16),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](17,"tr"),s["\u0275\u0275elementStart"](18,"td"),s["\u0275\u0275text"](19,"Selling Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](20,"td"),s["\u0275\u0275text"](21),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](22,"tr"),s["\u0275\u0275elementStart"](23,"td"),s["\u0275\u0275text"](24,"Unit"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](25,"td"),s["\u0275\u0275text"](26),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](27,"tr"),s["\u0275\u0275elementStart"](28,"td"),s["\u0275\u0275text"](29,"Cost Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](30,"td"),s["\u0275\u0275text"](31),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](32,"tr"),s["\u0275\u0275elementStart"](33,"td"),s["\u0275\u0275text"](34,"Expiry Date"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](35,"td"),s["\u0275\u0275text"](36),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](37,"tr"),s["\u0275\u0275elementStart"](38,"td"),s["\u0275\u0275text"](39,"Notes"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](40,"td"),s["\u0275\u0275text"](41),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](42,"tr"),s["\u0275\u0275elementStart"](43,"td"),s["\u0275\u0275text"](44,"Size"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](45,"td"),s["\u0275\u0275text"](46),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](47,"tr"),s["\u0275\u0275elementStart"](48,"td"),s["\u0275\u0275text"](49,"Shelf/Location"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](50,"td"),s["\u0275\u0275text"](51),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](52,"tr"),s["\u0275\u0275elementStart"](53,"td"),s["\u0275\u0275text"](54,"Barcode"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](55,"td"),s["\u0275\u0275text"](56),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](6),s["\u0275\u0275textInterpolate1"]("",n.object.name," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.category," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.stock," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.price," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.unit," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.cost_price," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.expiry," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.notes," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.size," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.shelf," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",n.object.barcode," ")}}function _(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function v(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",45),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" Sales Invoice: #",n.selected_item.invoice," ")}}function b(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function y(e,t){if(1&e&&s["\u0275\u0275element"](0,"app-sales-history",46),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("show_return",!1)("objects",n.sale_invoice_objects)}}function g(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",45),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" Purchase Invoice - #",n.selected_item.invoice," ")}}function S(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function E(e,t){if(1&e&&s["\u0275\u0275element"](0,"app-purchase-history",47),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("objects",n.purchase_invoice_objects)}}function k(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"div",45),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" Transfer Invoice - #",n.selected_item.invoice," ")}}function x(e,t){1&e&&s["\u0275\u0275element"](0,"app-loading")}function w(e,t){if(1&e&&s["\u0275\u0275element"](0,"app-transfer-history",47),2&e){var n=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("objects",n.transfer_invoice_objects)}}var j,I,C,D=[{path:"",component:(j=function(){function e(t,n,a,i){_classCallCheck(this,e),this.dbService=n,this.notify=a,this.authService=i,this.error=!1,this.is_loading=!0,this.is_loaded=!1,this.orders=[],this.is_loading_orders=!0,this.is_loaded_orders=!1,this.sales=[],this.is_loading_sales=!0,this.is_loaded_sales=!1,this.purchases=[],this.is_loading_purchases=!0,this.is_loaded_purchases=!1,this.stock_changes=[],this.branches=[],-1==this.authService.current_user.permissions.indexOf("View Inventory")&&(this.notify.failNotification("You are not permitted to view the page"),this.goBack()),this.dbService.setTitle("Product Details"),this.id=t.snapshot.params.id}return _createClass(e,[{key:"ngOnInit",value:function(){this.getObject(this.id)}},{key:"getObject",value:function(e){var t=this;this.is_loading=!0,this.is_loaded=!1,this.error=!1,this.dbService.getDataWithQuery("product/findById",this.authService.current_user,"id="+this.id).subscribe((function(e){t.object=e.data,t.is_loading=!1,t.is_loaded=!0,t.error=!1,t.getChanges()}),(function(e){t.is_loading=!1,t.error=!0,t.is_loaded=!1}))}},{key:"getOrders",value:function(){var e=this;this.dbService.getDataWithQuery("order/getList",this.authService.current_user,"product="+this.object.name).subscribe((function(t){e.orders=t.data,e.is_loading_orders=!1,e.is_loaded_orders=!0}),(function(t){e.is_loading_orders=!1,e.is_loaded_orders=!1}))}},{key:"getSales",value:function(){var e=this;this.dbService.getDataWithQuery("sale/getProductSales",this.authService.current_user,"product="+this.object.id).subscribe((function(t){e.sales=t.data,e.is_loading_sales=!1,e.is_loaded_sales=!0}),(function(t){e.is_loading_sales=!1,e.is_loaded_sales=!1}))}},{key:"getChanges",value:function(){var e=this;this.dbService.getDataWithQuery("product/getStockChanges",this.authService.current_user,"product="+this.object.id).subscribe((function(t){if("-1"==t.status);else{e.dbService.sortObjects(t.data,"timestamp");var n=0;t.data.map((function(e){switch(e.type){case"sale":e.previous_stock=n,e.new_stock=n-=parseInt(e.quantity);break;case"stock_adjustment":e.previous_stock=n,e.new_stock=n=parseInt(e.quantity);break;case"purchase":case"transfer":e.previous_stock=n,e.new_stock=n+=parseInt(e.quantity)}})),e.stock_changes=t.data}e.is_loading_purchases=!1,e.is_loaded_purchases=!0}),(function(t){e.is_loading_purchases=!1,e.is_loaded_purchases=!1}))}},{key:"showDetails",value:function(e){switch(e.type){case"purchase":this.showPurchaseInvoiceDetails(e);break;case"transfer":this.showTransferInvoiceDetails(e);break;case"sale":default:this.showSalesInvoiceDetails(e.invoice)}}},{key:"showSalesInvoiceDetails",value:function(e){var t=this;$("#sale_details_modal").modal("show"),this.is_loaded_sales_details=!1,this.is_loading_sales_details=!0,this.dbService.getData("sale/getSaleDetails?code="+e,this.authService.current_user).subscribe((function(e){t.sale_invoice_objects=e.data,t.sale_invoice_objects.map((function(e){})),t.is_loaded_sales_details=!0,t.is_loading_sales_details=!1}),(function(e){t.is_loaded_sales_details=!0,t.is_loading_sales_details=!1,t.notify.failNotification("Unable to get sales")}))}},{key:"showPurchaseInvoiceDetails",value:function(e){var t=this;$("#purchase_details_modal").modal("show"),this.selected_item=e,this.is_loaded_purchase_details=!1,this.is_loading_purchase_details=!0,this.dbService.getData("purchase/getDetails?code="+e.invoice,this.authService.current_user).subscribe((function(e){t.purchase_invoice_objects=e.data,t.purchase_invoice_objects.map((function(e){})),t.is_loaded_purchase_details=!0,t.is_loading_purchase_details=!1}),(function(e){t.is_loaded_purchase_details=!0,t.is_loading_purchase_details=!1,t.notify.failNotification("Unable to get purchases invoice")}))}},{key:"showTransferInvoiceDetails",value:function(e){var t=this;$("#transfer_details_modal").modal("show"),this.selected_item=e,this.is_loaded_transfer_details=!1,this.is_loading_transfer_details=!0,this.dbService.getData("transfer/getDetails?code="+e.invoice,this.authService.current_user).subscribe((function(e){t.transfer_invoice_objects=e.data,t.transfer_invoice_objects.map((function(e){})),t.is_loaded_transfer_details=!0,t.is_loading_transfer_details=!1}),(function(e){t.is_loaded_transfer_details=!0,t.is_loading_transfer_details=!1,t.notify.failNotification("Unable to get transfers")}))}},{key:"goBack",value:function(){window.history.back()}},{key:"getBranchDetails",value:function(){var e=this;this.is_loading_branches=!0,this.notify.showLoading(),this.dbService.getData("product/getBranchProductDetails?only_others=no&product_id="+this.id,this.authService.current_user).subscribe((function(t){e.notify.hideLoading(),"-1"===t.status||(e.branches=t.data,e.is_loading_branches=!1)}),(function(t){e.is_loading_branches=!0,e.notify.hideLoading(),e.notify.noConnectionNotification()}))}},{key:"salesSelected",value:function(e){this.showSalesInvoiceDetails(e[0].code)}},{key:"delete",value:function(){var e=this;if(window.confirm("Sure you want to delete the selected products?")){var t=[this.id],n=new FormData;this.notify.showLoading(),n.append("id",t.toString()),this.dbService.postData(n,"product/delete",this.authService.current_user).subscribe((function(t){switch(e.notify.hideLoading(),t.status){case"0":e.notify.failNotification("Error: You are not logged in");break;case"-9":e.notify.failNotification("Error: You are not permitted");break;case"-1":$("#erase_modal").modal("show");break;default:e.goBack(),e.notify.showNotification("Products deleted successfully","success",3e3)}}),(function(t){e.notify.noConnectionNotification()}))}}},{key:"erase",value:function(){var e=this;$("#erase_modal").modal("hide");var t=[this.id],n=new FormData;this.notify.showLoading(),n.append("id",t.toString()),this.dbService.postData(n,"product/erase",this.authService.current_user).subscribe((function(t){switch(e.notify.hideLoading(),t.status){case"0":e.notify.failNotification("Error: You are not logged in");break;case"-9":e.notify.failNotification("Error: You are not permitted");break;case"-1":alert("Server error! Please try again or contact admin");break;default:e.goBack(),e.notify.showNotification("Products deleted successfully","success",3e3)}}),(function(t){e.notify.noConnectionNotification()}))}}]),e}(),j.\u0275fac=function(e){return new(e||j)(s["\u0275\u0275directiveInject"](i.a),s["\u0275\u0275directiveInject"](o.a),s["\u0275\u0275directiveInject"](r.a),s["\u0275\u0275directiveInject"](l.a))},j.\u0275cmp=s["\u0275\u0275defineComponent"]({type:j,selectors:[["app-product-details"]],decls:84,vars:15,consts:[[1,"content"],[1,"container"],[1,"row"],[1,"col-12"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],[1,"fa","fa-edit"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-refresh"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-remove"],[4,"ngIf"],["class"," col-md-4",4,"ngIf"],[1,"col-md-8"],["role","tablist",1,"nav","nav-tabs","md-tabs"],[1,"nav-item"],["role","tab","href","#purchase","data-toggle","tab",1,"nav-link","active"],[1,"nav-item",3,"click"],["role","tab","href","#sales","data-toggle","tab",1,"nav-link"],[1,"slide"],[1,"tab-content","tabs","card-block"],["role","tabpanel","id","purchase",1,"tab-pane","active"],[1,"card"],[1,"card-header"],[1,"fa","fa-info"],[1,"card-body"],[3,"id"],["role","tabpanel","id","sales",1,"tab-pane"],[3,"objects","onFinish"],["id","sale_details_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],["class","modal-header",4,"ngIf"],[1,"modal-body"],[3,"show_return","objects",4,"ngIf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-danger"],["id","purchase_details_modal","tabindex","-1","role","dialog",1,"modal","fade"],[3,"objects",4,"ngIf"],["id","transfer_details_modal","tabindex","-1","role","dialog",1,"modal","fade"],["id","erase_modal","tabindex","-1","role","dialog",1,"modal","fade"],[1,"modal-header","text-danger"],["data-dismiss","modal",1,"btn","btn-danger","btn-sm"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"col-md-4"],[1,"table","table-striped","table-bordered"],[1,"modal-header"],[3,"show_return","objects"],[3,"objects"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"section",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"div",2),s["\u0275\u0275elementStart"](3,"div",3),s["\u0275\u0275elementStart"](4,"h5"),s["\u0275\u0275text"](5,"Product Details "),s["\u0275\u0275elementStart"](6,"a",4),s["\u0275\u0275element"](7,"i",5),s["\u0275\u0275text"](8," Edit"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](9,"button",6),s["\u0275\u0275listener"]("click",(function(){return t.ngOnInit()})),s["\u0275\u0275element"](10,"i",7),s["\u0275\u0275text"](11," Refresh"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](12,"button",8),s["\u0275\u0275listener"]("click",(function(){return t.delete()})),s["\u0275\u0275element"](13,"i",9),s["\u0275\u0275text"](14," Delete"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](15,h,1,0,"app-loading",10),s["\u0275\u0275elementStart"](16,"div",2),s["\u0275\u0275template"](17,p,57,11,"div",11),s["\u0275\u0275elementStart"](18,"div",12),s["\u0275\u0275elementStart"](19,"ul",13),s["\u0275\u0275elementStart"](20,"li",14),s["\u0275\u0275elementStart"](21,"a",15),s["\u0275\u0275text"](22,"STOCK CHANGES"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](23,"li",16),s["\u0275\u0275listener"]("click",(function(){return t.getSales()})),s["\u0275\u0275elementStart"](24,"a",17),s["\u0275\u0275text"](25,"SALES"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](26,"div",18),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](27,"div",19),s["\u0275\u0275elementStart"](28,"div",20),s["\u0275\u0275elementStart"](29,"div",21),s["\u0275\u0275elementStart"](30,"div",22),s["\u0275\u0275element"](31,"i",23),s["\u0275\u0275text"](32," Click an invoice number for more details "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](33,"div",24),s["\u0275\u0275element"](34,"app-product-history",25),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](35,"div",26),s["\u0275\u0275template"](36,_,1,0,"app-loading",10),s["\u0275\u0275elementStart"](37,"div",21),s["\u0275\u0275elementStart"](38,"div",24),s["\u0275\u0275elementStart"](39,"app-sales-history",27),s["\u0275\u0275listener"]("onFinish",(function(e){return t.salesSelected(e)})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](40,"div",28),s["\u0275\u0275elementStart"](41,"div",29),s["\u0275\u0275elementStart"](42,"div",30),s["\u0275\u0275template"](43,v,2,1,"div",31),s["\u0275\u0275elementStart"](44,"div",32),s["\u0275\u0275template"](45,b,1,0,"app-loading",10),s["\u0275\u0275template"](46,y,1,2,"app-sales-history",33),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](47,"div",34),s["\u0275\u0275elementStart"](48,"button",35),s["\u0275\u0275text"](49,"Close"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](50,"div",36),s["\u0275\u0275elementStart"](51,"div",29),s["\u0275\u0275elementStart"](52,"div",30),s["\u0275\u0275template"](53,g,2,1,"div",31),s["\u0275\u0275elementStart"](54,"div",32),s["\u0275\u0275template"](55,S,1,0,"app-loading",10),s["\u0275\u0275template"](56,E,1,1,"app-purchase-history",37),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](57,"div",34),s["\u0275\u0275elementStart"](58,"button",35),s["\u0275\u0275text"](59,"Close"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](60,"div",38),s["\u0275\u0275elementStart"](61,"div",29),s["\u0275\u0275elementStart"](62,"div",30),s["\u0275\u0275template"](63,k,2,1,"div",31),s["\u0275\u0275elementStart"](64,"div",32),s["\u0275\u0275template"](65,x,1,0,"app-loading",10),s["\u0275\u0275template"](66,w,1,1,"app-transfer-history",37),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](67,"div",34),s["\u0275\u0275elementStart"](68,"button",35),s["\u0275\u0275text"](69,"Close"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](70,"div",39),s["\u0275\u0275elementStart"](71,"div",29),s["\u0275\u0275elementStart"](72,"div",30),s["\u0275\u0275elementStart"](73,"div",40),s["\u0275\u0275elementStart"](74,"h5"),s["\u0275\u0275text"](75,"Attention - Delete Product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](76,"br"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](77,"div",32),s["\u0275\u0275text"](78," This product has previous records. Do you really want to delete it? The system will also delete every record of the item in sales, purchases, transfers, stock adjustment "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](79,"div",34),s["\u0275\u0275elementStart"](80,"button",41),s["\u0275\u0275text"](81,"Cancel"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](82,"button",42),s["\u0275\u0275listener"]("click",(function(){return t.erase()})),s["\u0275\u0275text"](83,"Continue to Delete"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275advance"](6),s["\u0275\u0275propertyInterpolate1"]("routerLink","/edit_product/",t.id,""),s["\u0275\u0275advance"](9),s["\u0275\u0275property"]("ngIf",t.is_loading),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.is_loaded),s["\u0275\u0275advance"](17),s["\u0275\u0275property"]("id",t.id),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.is_loading_sales_details),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("objects",t.sales),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngIf",null!=t.selected_item),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.is_loading_sales_details),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.is_loaded_sales_details),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngIf",null!=t.selected_item),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.is_loading_purchase_details),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.is_loaded_purchase_details),s["\u0275\u0275advance"](7),s["\u0275\u0275property"]("ngIf",null!=t.selected_item),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf",t.is_loading_transfer_details),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.is_loaded_transfer_details))},directives:[i.e,a.j,d.a,c.a,u.a,m.a,f.a],styles:[""]}),j)}],N=((I=function e(){_classCallCheck(this,e)}).\u0275mod=s["\u0275\u0275defineNgModule"]({type:I}),I.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||I)},imports:[[i.f.forChild(D)],i.f]}),I),q=n("nEHF"),L=n("nBlB"),P=n("rNAZ"),T=n("wDHj"),F=((C=function e(){_classCallCheck(this,e)}).\u0275mod=s["\u0275\u0275defineNgModule"]({type:C}),C.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||C)},imports:[[a.b,N,q.a,L.a,P.a,T.a]]}),C)},mS1k:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=function e(){_classCallCheck(this,e)}},nBlB:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("ofXK"),i=n("nEHF"),s=n("fXoL"),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.b,i.a]]}),e}()},rfqN:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n("fXoL"),i=n("c92J"),s=n("1VJT"),o=n("ccyI"),r=n("ofXK"),l=n("n49D"),d=n("nVU4"),c=["agGrid"];function u(e,t){1&e&&(a["\u0275\u0275elementStart"](0,"div",1),a["\u0275\u0275elementStart"](1,"h4"),a["\u0275\u0275text"](2,"No results"),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"]())}var m=function(){var e=function(){function e(t,n,i){_classCallCheck(this,e),this.dbService=t,this.notify=n,this.authService=i,this.objects=[],this.show_options=!0,this.type="",this.receipt="",this.onReturn=new a.EventEmitter,this.can_view=!0,this.can_edit=!0,this.can_create=!0,this.can_delete=!0,this.edit_keys=["quantity"],this.offset=0,this.summary=[],this.overall_total=0,this.quantity_error=!1,this.columnDefs=[{headerName:"Product",field:"product_name",sortable:!0,filter:!0,checkboxSelection:!1},{headerName:"Quantity",field:"quantity",sortable:!0,filter:!0},{headerName:"Price",field:"price",sortable:!0,filter:!0},{headerName:"Total Amount",field:"total",sortable:!0,filter:!0},{headerName:"Receipt",field:"code",sortable:!0,filter:!0},{headerName:"Date",field:"date",sortable:!0,filter:!0}],this.rowData=[],this.selected_items=[],-1==this.authService.current_user.permissions.indexOf("Delete Transfers")&&(this.can_delete=!1),this.defaultColDef={resizable:!0}}return _createClass(e,[{key:"ngOnInit",value:function(){this.prep()}},{key:"onGridReady",value:function(e){this.gridApi=e.api,this.agGrid.api.sizeColumnsToFit()}},{key:"onSelectionChanged",value:function(e){var t=this.gridApi.getSelectedRows();this.selected_items=t}},{key:"ngOnChanges",value:function(){this.prep()}},{key:"prep",value:function(){this.objects.map((function(e){e.total=e.price*e.quantity})),this.calculateTotals()}},{key:"startEdit",value:function(e){this.selected=e,this.new_quantity=this.selected.quantity,$("#edit_sale_modal").modal({backdrop:"static",keyboard:!1})}},{key:"returnSelected",value:function(){$("#return_sale_modal").modal({backdrop:"static",keyboard:!1})}},{key:"getSelectedRows",value:function(){var e=this.agGrid.api.getSelectedNodes().map((function(e){return e.data})).map((function(e){return e.product_name+" "+e.price})).join(", ");alert("Selected nodes: ".concat(e))}},{key:"checkQuantity",value:function(){this.quantity_error=!1,parseInt(this.new_quantity)>this.selected.quantity&&(this.quantity_error=!0,this.new_quantity=this.selected.quantity)}},{key:"saveReturns",value:function(){var e=this;if(null==this.selected_items||null==this.selected_items||this.selected_items.length<1)return this.notify.failNotification("Please add at least one product"),!1;this.notify.showLoading();for(var t=[],n=[],a=[],i=[],s="RFS-"+this.dbService.getToday("timestamp_string"),o=0;o<this.selected_items.length;o++){var r=this.selected_items[o];t.push(r.product_id),n.push(r.price),a.push(-1*r.quantity),i.push(r.product_name)}var l=new FormData;l.append("products",t.join("||")),l.append("prices",n.join("||")),l.append("quantities",a.join("||")),l.append("code",s),l.append("product_names",i.join("||")),l.append("amount_paid","0"),l.append("created_by",this.authService.current_user.id),l.append("date",this.dbService.getToday()),l.append("display_name",this.authService.current_user.display_name),l.append("payment_method","Return"),this.dbService.postData(l,"sale/saveBulk",this.authService.current_user).subscribe((function(t){e.notify.hideLoading(),"-1"===t.status?e.notify.failNotification("Unable to authenticate. Please login again"):"-9"===t.status?e.notify.showNotification("You are not permitted to perform this action","fail",3e3):($("#return_sale_modal").modal("hide"),e.agGrid.api.deselectAll(),e.selected_items=[],e.notify.hideLoading(),e.onReturn.emit(t.code),e.notify.successNotification("Items returned successfully"))}),(function(t){e.notify.hideLoading(),e.notify.noConnectionNotification(),console.log(t)}))}},{key:"saveQuantity",value:function(){var e=this;$("#edit_sale_modal").modal("hide");var t=new FormData;this.notify.showLoading();var n=-1*parseFloat(this.new_quantity);t.append("quantities",n.toString()),t.append("products",this.selected.product.id),t.append("prices",this.selected.price.toFixed(2)),t.append("product_name",this.selected.product.name),t.append("created_by",this.authService.current_user.id),t.append("date",this.dbService.getToday()),this.dbService.postData(t,"sale/saveBulk",this.authService.current_user).subscribe((function(t){switch(e.notify.hideLoading(),t.status){case"0":e.notify.failNotification("You are not logged in");break;case"-1":e.notify.failNotification("server error. Contact admin");break;case"-9":e.notify.failNotification("You are not permitted ");break;default:e.notify.successNotification("sale edited successfully"),e.calculateTotals()}}),(function(t){e.notify.noConnectionNotification()}))}},{key:"delete",value:function(e){var t=this;if(window.confirm("Sure you want to delete this sale? You cannot undo this")){var n=new FormData;this.notify.showLoading(),n.append("id",e.id),n.append("display_name",this.authService.current_user.display_name),n.append("code",e.code),n.append("name",e.product.name),this.dbService.postData(n,"sale/deleteItem",this.authService.current_user).subscribe((function(n){t.notify.hideLoading(),"1"===n.status&&(t.objects.splice(t.objects.indexOf(e),1),t.notify.showNotification("Sale deleted successfully","success",3e3),t.calculateTotals())}),(function(e){t.notify.noConnectionNotification()}))}}},{key:"calculateTotals",value:function(){var e=0;this.objects.map((function(t){e+=t.price*t.quantity})),this.overall_total=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(a["\u0275\u0275directiveInject"](i.a),a["\u0275\u0275directiveInject"](s.a),a["\u0275\u0275directiveInject"](o.a))},e.\u0275cmp=a["\u0275\u0275defineComponent"]({type:e,selectors:[["app-transfer-history"]],viewQuery:function(e,t){var n;1&e&&a["\u0275\u0275viewQuery"](c,!0),2&e&&a["\u0275\u0275queryRefresh"](n=a["\u0275\u0275loadQuery"]())&&(t.agGrid=n.first)},inputs:{objects:"objects",show_options:"show_options",type:"type",receipt:"receipt",offset:"offset"},outputs:{onReturn:"onReturn"},features:[a["\u0275\u0275NgOnChangesFeature"]],decls:11,vars:6,consts:[["class","",4,"ngIf"],[1,""],["id","sales_details"],[1,"well"],[1,"text-danger"],[3,"objects"],["rowSelection","single",1,"ag-theme-balham",2,"width","100%","height","400px","font-family","Muli","font-size","15px",3,"rowData","columnDefs","defaultColDef","selectionChanged","gridReady"],["agGrid",""]],template:function(e,t){1&e&&(a["\u0275\u0275template"](0,u,3,0,"div",0),a["\u0275\u0275elementStart"](1,"div",1),a["\u0275\u0275elementStart"](2,"div",2),a["\u0275\u0275elementStart"](3,"div",3),a["\u0275\u0275elementStart"](4,"b"),a["\u0275\u0275text"](5,"Overall Total: "),a["\u0275\u0275elementStart"](6,"span",4),a["\u0275\u0275text"](7),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275element"](8,"app-export-to-excel",5),a["\u0275\u0275elementStart"](9,"ag-grid-angular",6,7),a["\u0275\u0275listener"]("selectionChanged",(function(e){return t.onSelectionChanged(e)}))("gridReady",(function(e){return t.onGridReady(e)})),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"]()),2&e&&(a["\u0275\u0275property"]("ngIf",t.objects.length<1),a["\u0275\u0275advance"](7),a["\u0275\u0275textInterpolate1"]("GHC ",t.overall_total.toFixed(2),""),a["\u0275\u0275advance"](1),a["\u0275\u0275property"]("objects",t.objects),a["\u0275\u0275advance"](1),a["\u0275\u0275property"]("rowData",t.objects)("columnDefs",t.columnDefs)("defaultColDef",t.defaultColDef))},directives:[r.j,l.a,d.AgGridAngular],styles:[""]}),e}()},wDHj:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("ofXK"),i=n("nEHF"),s=n("6QD7"),o=n("fXoL"),r=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.b,i.a,s.b],s.b]}),e}()}}]);