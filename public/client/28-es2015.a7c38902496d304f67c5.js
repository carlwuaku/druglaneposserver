(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"1oy2":function(e,t,n){"use strict";n.r(t),n.d(t,"AddOrderModule",(function(){return j}));var i=n("ofXK"),r=n("tyNb"),s=n("fXoL"),a=n("N6Jo");class o{constructor(){}}var l=n("c92J"),d=n("eJvr"),c=n("1VJT"),h=n("ccyI"),m=n("3Pt+");function p(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"option",5),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275propertyInterpolate"]("value",e),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"]("",e," ")}}function u(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"option",6),s["\u0275\u0275text"](1,"Other"),s["\u0275\u0275elementEnd"]())}function f(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"span"),s["\u0275\u0275elementStart"](1,"select",1),s["\u0275\u0275listener"]("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().selected=t}))("change",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().item_selected()})),s["\u0275\u0275template"](2,p,2,2,"option",2),s["\u0275\u0275template"](3,u,2,0,"option",3),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](4,"i",4),s["\u0275\u0275listener"]("click",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().ngOnInit()})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngModel",e.selected),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngForOf",e.objects),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",e.show_other)}}function g(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"option",5),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275propertyInterpolate"]("value",e),s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"]("",e," ")}}function _(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"span"),s["\u0275\u0275elementStart"](1,"datalist",7),s["\u0275\u0275template"](2,g,2,2,"option",2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngForOf",e.objects)}}let v=(()=>{class e{constructor(e,t,n){this.dbService=e,this.notify=t,this.authService=n,this.objects=[],this.is_loading=!1,this.error=!1,this.is_loaded=!1,this.onFinish=new s.EventEmitter,this.selected=null,this.type="",this.show_other=!0}ngOnInit(){this.start()}ngOnChanges(){console.log(this.tracker),this.start()}start(){this.is_loaded=!1,this.is_loading=!0;var e="";switch(this.type){case"packaging":e="order/getDeliveryPoints?status=Pending";break;case"delivery":e="order/getDeliveryPoints?status=Packaged";break;default:e="order/getDeliveryPoints"}this.dbService.getData(e,this.authService.current_user).subscribe(e=>{"-1"===e.status&&(this.notify.failNotification(e.message),this.error=!0),"-9"===e.status?(this.notify.failNotification(e.message),this.error=!0):(this.objects=e.data,this.is_loaded=!0,this.error=!1),this.is_loading=!1},e=>{this.notify.noConnectionNotification()})}item_selected(){this.onFinish.emit(this.selected)}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](l.a),s["\u0275\u0275directiveInject"](c.a),s["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-select-delivery-point"]],inputs:{selected:"selected",type:"type",show_other:"show_other",tracker:"tracker"},outputs:{onFinish:"onFinish"},features:[s["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:2,consts:[[4,"ngIf"],["name","selected",1,"",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["value","other",4,"ngIf"],[1,"fa","fa-refresh",3,"click"],[3,"value"],["value","other"],["id","delivery_point_list"]],template:function(e,t){1&e&&(s["\u0275\u0275template"](0,f,5,3,"span",0),s["\u0275\u0275template"](1,_,3,1,"span",0)),2&e&&(s["\u0275\u0275property"]("ngIf",t.is_loaded&&"datalist"!=t.type),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.is_loaded&&"datalist"==t.type))},directives:[i.j,m.m,m.e,m.h,i.i,m.i,m.n],styles:[""]}),e})();var y=n("4j6H");function b(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"input",30),s["\u0275\u0275listener"]("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().order.delivery_point=t})),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("ngModel",e.order.delivery_point)}}function S(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275elementStart"](4,"input",31),s["\u0275\u0275listener"]("ngModelChange",(function(n){return s["\u0275\u0275restoreView"](e),t.$implicit.quantity=n}))("change",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().getTotal()}))("keyup",(function(){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().getTotal()})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"td"),s["\u0275\u0275text"](6),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"td"),s["\u0275\u0275text"](8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](9,"td"),s["\u0275\u0275elementStart"](10,"a",32),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](e);const n=t.$implicit;return s["\u0275\u0275nextContext"]().removeItem(n)})),s["\u0275\u0275element"](11,"i",33),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](e.product_name),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngModel",e.quantity),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](e.price),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"]((e.price*e.quantity).toFixed(2))}}function x(e,t){if(1&e){const e=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"span"),s["\u0275\u0275text"](1),s["\u0275\u0275elementStart"](2,"div",34),s["\u0275\u0275elementStart"](3,"input",35),s["\u0275\u0275listener"]("ngModelChange",(function(t){return s["\u0275\u0275restoreView"](e),s["\u0275\u0275nextContext"]().new_quantity=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](4,"input",36),s["\u0275\u0275elementEnd"]()}if(2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate3"](" ",e.new_item.name," [price: ",e.new_item.price,"/",e.new_item.unit,"] "),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngModel",e.new_quantity)}}function w(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"option"),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"]("",e.phone," ")}}let E=(()=>{class e{constructor(e,t,n,i){this.dbService=e,this.localforage=t,this.notify=n,this.authService=i,this.error=!1,this.is_loading=!0,this.is_loaded=!1,this.onFinish=new s.EventEmitter,this.url="orders/findById",this.items=[],this.new_item=null,this.new_quantity=0,this.amount_paid="0",this.added_names=[],this.order_total=0,this.editing=!1,this.customers_local=[],this.ts="",null!=this.id&&null!=this.id||(this.order=new a.a,this.order.createdAt=this.dbService.getToday())}ngOnInit(){if(this.ts=this.dbService.getToday(),null==this.id||null==this.id||this.getObject(this.id),null!=this.order._id&&null!=this.order._id){this.getTotal();var e=this;this.items.map(t=>{e.added_names.push(t.product_name)}),this.order.createdAt=this.dbService.getToday("",this.order.createdAt),this.editing=!0}this.localforage.getItem("customers").subscribe(e=>{this.customers_local=e,console.log(this.customers_local)},e=>{console.log(e)})}deliveryPointSelected(e){this.dp_selected=e,"other"!=this.dp_selected&&(this.order.delivery_point=e)}getObject(e){this.dbService.getDataWithQuery(this.url,this.authService.current_user,"id="+this.id).subscribe(e=>{this.order=e.data,this.is_loading=!1,this.is_loaded=!0,this.error=!1},e=>{this.is_loading=!1,this.error=!0,this.is_loaded=!1})}customerSelected(e){this.order.customer=e}populateCustomer(){this.first_name="",this.last_name="",this.work_place="";for(var e=0;e<this.customers_local.length;e++){var t=this.customers_local[e];if(t.phone==this.phone){this.first_name=t.first_name,this.last_name=t.last_name,this.work_place=t.place_of_work;break}}}trackBy(e,t){return t.product._id}productSelected(e){if(-1==this.added_names.indexOf(e.name)){if(this.new_item=e,"number"!=typeof e.price)return this.notify.failNotification("Price not defined."),!1;this.new_quantity=1,$("#enter_quantity_modal").modal("show"),$("#enter_quantity_modal").on("shown.bs.modal",(function(){$("#qtt").focus()}))}else this.notify.failNotification("Item already in list")}increment(e){null!=e&&null!=e?(e.quantity=(parseFloat(e.quantity)+1).toString(),this.getTotal()):this.new_quantity++}decrement(e){null!=e&&null!=e?parseFloat(e.quantity)>1&&(e.quantity=(parseFloat(e.quantity)-1).toString(),this.getTotal()):parseFloat(this.new_quantity)>1&&this.new_quantity--}addItem(){if(!$.isNumeric(this.new_quantity))return this.notify.failNotification("Enter a valid number"),!1;if(parseFloat(this.new_quantity)<0)return this.notify.failNotification("Enter a quantity above 0"),!1;if(-1==this.added_names.indexOf(this.new_item.name)){var e=new o;e.product_name=this.new_item.name,e.product_id=this.new_item.id,e.price=this.new_item.price,e.quantity=this.new_quantity,e.total=this.new_quantity*this.new_item.price,this.items.push(e),this.added_names.push(this.new_item.name),this.new_item=null,this.new_quantity=0,this.getTotal(),$("#enter_quantity_modal").modal("hide"),this.ts=this.dbService.getToday("timestamp_string")}else this.ts=this.dbService.getToday("timestamp_string"),this.notify.failNotification("Item already in the list")}removeItem(e){this.items.splice(this.items.indexOf(e),1),this.added_names.splice(this.added_names.indexOf(e.name),1),this.getTotal()}setQuantities(){var e=0,t=this;$(".quantities").each((function(){t.items[e].quantity=$(this).val(),e++})),this.getTotal()}getTotal(){var e=0;this.items.map(t=>{e+=t.quantity*t.price}),this.order_total=e}saveItems(){if(this.phone)return this.notify.failNotification("Please fill the customer details"),!1;if(null==this.items||null==this.items||this.items.length<1)return this.notify.failNotification("Please add at least one product"),!1;this.notify.showLoading();for(var e="RF-"+this.dbService.getToday("timestamp_string"),t=0;t<this.items.length;t++){var n=this.items[t];let i=new FormData;i.append("id",this.order._id),i.append("product",n.product_id),i.append("price",n.price.toFixed(2)),i.append("quantity",n.quantity.toFixed(2)),i.append("phone",this.phone),i.append("first_name",this.first_name),i.append("last_name",this.last_name),i.append("place_of_work",this.work_place),i.append("delivery_point",this.order.delivery_point),i.append("notes",this.order.notes),i.append("status","Pending"),i.append("code",e),i.append("customer_name",this.order.customer.first_name+" "+this.order.customer.last_name),i.append("product_name",n.product_name),i.append("createdAt",this.dbService.getToday("timestamp")),i.append("display_name",this.authService.current_user.display_name),this.dbService.postData(i,"orders/save",this.authService.current_user).subscribe(e=>{this.notify.hideLoading(),"-1"===e.status?this.notify.failNotification("Unable to authenticate. Please login again"):"-9"===e.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):(this.order=new a.a,this.items=this.added_names=[],this.getTotal())},e=>{})}this.notify.successNotification("Orders saved successfully")}saveBulk(){if(null==this.items||null==this.items||this.items.length<1)return this.notify.failNotification("Please add at least one product"),!1;if(null==this.phone||null==this.phone||null==this.first_name||null==this.first_name||null==this.last_name||null==this.last_name)return this.notify.failNotification("Please fill the customer details"),!1;if(""==this.order.delivery_point||null==this.order.delivery_point||null==this.order.delivery_point)return this.notify.failNotification("Please select a delivery point"),!1;this.notify.showLoading();var e=[],t=[],n=[],i=[];if(this.editing)r=this.order.code;else{this.order_code=this.dbService.abbreviate(this.order.delivery_point,2);var r=this.order_code+"-"+this.dbService.getToday("timestamp_string")}for(var s=0;s<this.items.length;s++){var o=this.items[s];e.push(o.product_id),t.push(o.price),n.push(o.quantity),i.push(o.product_name)}let l=new FormData;l.append("products",e.join("||")),l.append("prices",t.join("||")),l.append("quantities",n.join("||")),l.append("code",r),l.append("product_names",i.join("||")),l.append("added_by",this.authService.current_user._id),l.append("display_name",this.authService.current_user.display_name),l.append("phone",this.phone),l.append("first_name",this.first_name),l.append("last_name",this.last_name),l.append("place_of_work",this.work_place),l.append("amount_paid",this.amount_paid),l.append("delivery_point",this.order.delivery_point),l.append("notes",this.order.notes),l.append("status",this.order.status),this.editing&&l.append("editing","yes"),this.dbService.postData(l,"order/saveBulk",this.authService.current_user).subscribe(e=>{this.notify.hideLoading(),"-1"===e.status?this.notify.failNotification("Unable to authenticate. Please login again"):"-9"===e.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):(this.notify.hideLoading(),this.order=new a.a,this.items=this.added_names=[],this.getTotal(),this.notify.successNotification("Order saved successfully"),this.ts=this.dbService.getToday("timestamp_string"))},e=>{this.ts=this.dbService.getToday("timestamp_string"),this.notify.hideLoading(),this.notify.noConnectionNotification()})}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](l.a),s["\u0275\u0275directiveInject"](d.a),s["\u0275\u0275directiveInject"](c.a),s["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-order-form"]],inputs:{order:"order",id:"id",items:"items"},outputs:{onFinish:"onFinish"},decls:83,vars:16,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-md-4"],["autocomplete","off","list","customers","type","text","name","phone",3,"ngModel","change","keyup","ngModelChange"],["type","text","name","first_name",3,"ngModel","ngModelChange"],["type","text","name","last_name",3,"ngModel","ngModelChange"],["type","text","name","work_place",3,"ngModel","ngModelChange"],["required","","type","date","name","createdAt",3,"ngModel","ngModelChange"],["type","text","list","delivery_point_list","name","delivery_point",3,"ngModel","ngModelChange"],[3,"type"],["required","","type","text","name","delivery_point",3,"ngModel","ngModelChange",4,"ngIf"],["name","notes",1,"form-control",3,"ngModel","ngModelChange"],[3,"timestamp","type","onAdd"],[1,"col-md-8"],[1,"table","table-striped","table-bordered"],[4,"ngFor","ngForOf"],["type","text",3,"ngModel","ngModelChange"],["type","submit","name","submit","value","Submit",1,"btn","btn-success",3,"click"],["id","enter_quantity_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-sm"],[1,"modal-content"],[1,"modal-body"],["ngNativeValidate","",3,"ngSubmit"],["n","ngForm"],[4,"ngIf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-warning","waves-effect"],["id","customers"],["required","","type","text","name","delivery_point",3,"ngModel","ngModelChange"],["type","number","name","quantities[]",3,"ngModel","ngModelChange","change","keyup"],["title","remove this item",1,"btn","btn-xs","btn-warning",3,"click"],[1,"feather","icon-x"],[1,""],["type","text","required","","name","new_quantity","id","qtt","placeholder","quantity",3,"ngModel","ngModelChange"],["type","submit","name","submit","value","Add Item",1,"btn","btn-success","waves-effect"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"div",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"h6"),s["\u0275\u0275text"](3,"Customer details"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](4,"div",2),s["\u0275\u0275elementStart"](5,"div",3),s["\u0275\u0275elementStart"](6,"div",4),s["\u0275\u0275elementStart"](7,"label"),s["\u0275\u0275text"](8,"Phone number"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](9,"br"),s["\u0275\u0275elementStart"](10,"input",5),s["\u0275\u0275listener"]("change",(function(){return t.populateCustomer()}))("keyup",(function(){return t.populateCustomer()}))("ngModelChange",(function(e){return t.phone=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](11,"div",4),s["\u0275\u0275elementStart"](12,"label"),s["\u0275\u0275text"](13,"First Name"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](14,"br"),s["\u0275\u0275elementStart"](15,"input",6),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.first_name=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](16,"br"),s["\u0275\u0275elementStart"](17,"label"),s["\u0275\u0275text"](18,"Last Name"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](19,"br"),s["\u0275\u0275elementStart"](20,"input",7),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.last_name=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](21,"div",4),s["\u0275\u0275elementStart"](22,"label"),s["\u0275\u0275text"](23,"Work Place"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](24,"br"),s["\u0275\u0275elementStart"](25,"input",8),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.work_place=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](26,"div",3),s["\u0275\u0275elementStart"](27,"div",4),s["\u0275\u0275elementStart"](28,"label"),s["\u0275\u0275text"](29,"Date of Order*"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](30,"br"),s["\u0275\u0275elementStart"](31,"input",9),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.order.createdAt=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](32,"div",4),s["\u0275\u0275elementStart"](33,"label"),s["\u0275\u0275text"](34,"Delivery Point*"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](35,"br"),s["\u0275\u0275elementStart"](36,"input",10),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.order.delivery_point=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](37,"app-select-delivery-point",11),s["\u0275\u0275template"](38,b,1,1,"input",12),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](39,"div",4),s["\u0275\u0275elementStart"](40,"label"),s["\u0275\u0275text"](41,"Notes"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](42,"br"),s["\u0275\u0275elementStart"](43,"textarea",13),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.order.notes=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](44,"div",3),s["\u0275\u0275elementStart"](45,"div",4),s["\u0275\u0275elementStart"](46,"app-select-product",14),s["\u0275\u0275listener"]("onAdd",(function(e){return t.productSelected(e)})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](47,"div",15),s["\u0275\u0275elementStart"](48,"div",0),s["\u0275\u0275elementStart"](49,"div",2),s["\u0275\u0275elementStart"](50,"table",16),s["\u0275\u0275elementStart"](51,"thead"),s["\u0275\u0275elementStart"](52,"tr"),s["\u0275\u0275elementStart"](53,"th"),s["\u0275\u0275text"](54,"Product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](55,"th"),s["\u0275\u0275text"](56,"Quantity"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](57,"th"),s["\u0275\u0275text"](58,"Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](59,"th"),s["\u0275\u0275text"](60,"Total"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](61,"th"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](62,"tbody"),s["\u0275\u0275template"](63,S,12,4,"tr",17),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](64,"h4"),s["\u0275\u0275text"](65),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](66,"label"),s["\u0275\u0275text"](67,"Amount Paid"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275text"](68,": "),s["\u0275\u0275elementStart"](69,"input",18),s["\u0275\u0275listener"]("ngModelChange",(function(e){return t.amount_paid=e})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](70,"input",19),s["\u0275\u0275listener"]("click",(function(){return t.saveBulk()})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](71,"div",20),s["\u0275\u0275elementStart"](72,"div",21),s["\u0275\u0275elementStart"](73,"div",22),s["\u0275\u0275elementStart"](74,"div",23),s["\u0275\u0275elementStart"](75,"form",24,25),s["\u0275\u0275listener"]("ngSubmit",(function(){return t.addItem()})),s["\u0275\u0275template"](77,x,5,4,"span",26),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](78,"div",27),s["\u0275\u0275elementStart"](79,"button",28),s["\u0275\u0275text"](80,"Cancel"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](81,"datalist",29),s["\u0275\u0275template"](82,w,2,1,"option",17),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275advance"](10),s["\u0275\u0275property"]("ngModel",t.phone),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",t.first_name),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",t.last_name),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",t.work_place),s["\u0275\u0275advance"](6),s["\u0275\u0275property"]("ngModel",t.order.createdAt),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",t.order.delivery_point),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("type","datalist"),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf","other"==t.dp_selected),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",t.order.notes),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("timestamp",t.ts)("type","search"),s["\u0275\u0275advance"](17),s["\u0275\u0275property"]("ngForOf",t.items),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("Total: ",t.order_total,""),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngModel",t.amount_paid),s["\u0275\u0275advance"](8),s["\u0275\u0275property"]("ngIf",null!=t.new_item),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngForOf",t.customers_local))},directives:[m.b,m.e,m.h,m.l,v,i.j,y.a,i.i,m.f,m.g,m.j,m.i,m.n],styles:[""]}),e})();const C=[{path:"",component:(()=>{class e{constructor(e,t){this.router=t,this.id=e.snapshot.params.id}ngOnInit(){}productAdded(e){null==this.id||null==this.id||this.router.navigate(["/order/"+this.id])}goBack(){window.history.back()}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](r.a),s["\u0275\u0275directiveInject"](r.d))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-add-order"]],decls:7,vars:0,consts:[[1,"content"],[1,"container"],[1,"row"],[1,"col-12"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"section",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"div",2),s["\u0275\u0275elementStart"](3,"div",3),s["\u0275\u0275elementStart"](4,"h5"),s["\u0275\u0275text"](5,"Add a new order"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](6,"app-order-form"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]())},directives:[E],styles:[""]}),e})()}];let I=(()=>{class e{}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[r.f.forChild(C)],r.f]}),e})();var k=n("nEHF"),M=n("rMCG");let j=(()=>{class e{}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.b,I,k.a,M.a]]}),e})()},"4j6H":function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var i=n("fXoL"),r=n("c92J"),s=n("1VJT"),a=n("BbYg"),o=n("ccyI"),l=n("ofXK"),d=n("hiAm"),c=n("3Pt+"),h=n("tyNb");function m(e,t){1&e&&i["\u0275\u0275element"](0,"app-loading")}function p(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275elementStart"](1,"h4"),i["\u0275\u0275text"](2,"Not found"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}function u(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"option",9),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275propertyInterpolate"]("value",e.id),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"](" ",e.name," ")}}function f(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275elementStart"](1,"label"),i["\u0275\u0275text"](2,"Select Product"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"select",7),i["\u0275\u0275listener"]("ngModelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).select_product=t}))("change",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).productSelected()})),i["\u0275\u0275template"](4,u,2,2,"option",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngModel",e.select_product),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngForOf",e.objects)}}function g(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",3),i["\u0275\u0275elementStart"](1,"div",4),i["\u0275\u0275elementStart"](2,"button",5),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().addProduct()})),i["\u0275\u0275text"](3,"Add Product"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](4,m,1,0,"app-loading",6),i["\u0275\u0275template"](5,p,3,0,"div",6),i["\u0275\u0275template"](6,f,5,2,"div",6),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",e.is_searching),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.error_search),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.is_finished_search)}}function _(e,t){1&e&&i["\u0275\u0275element"](0,"app-loading")}function v(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275elementStart"](1,"h4"),i["\u0275\u0275text"](2,"Not found"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}function y(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"a",17),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit;return i["\u0275\u0275nextContext"](3).add(n)})),i["\u0275\u0275elementStart"](1,"b"),i["\u0275\u0275text"](2),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate3"]("",e.name," [price: ",e.price,"/",e.unit,"]")}}function b(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",13),i["\u0275\u0275elementStart"](1,"div",14),i["\u0275\u0275elementStart"](2,"input",15),i["\u0275\u0275listener"]("keyup",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).filterlist()}))("ngModelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).filter_param=t})),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](3,y,3,3,"a",16),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngModel",e.filter_param),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngForOf",e.filter_results)}}function S(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275elementStart"](1,"div",11),i["\u0275\u0275elementStart"](2,"button",5),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().addProduct()})),i["\u0275\u0275text"](3,"Add Product"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](4,_,1,0,"app-loading",6),i["\u0275\u0275template"](5,v,3,0,"div",6),i["\u0275\u0275template"](6,b,4,2,"div",12),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",e.is_searching),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.error_search),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.is_finished_search)}}function x(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275elementStart"](1,"b"),i["\u0275\u0275text"](2,"Not found"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}const w=function(e){return{"select-product-active":e}};function E(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"li",23),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit;return i["\u0275\u0275nextContext"](3).add(n)})),i["\u0275\u0275text"](1),i["\u0275\u0275element"](2,"br"),i["\u0275\u0275text"](3),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=t.index,r=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](5,w,n==r.arrowkeyLocation)),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"](" ",e.name," "),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate3"](" [price: ",e.price,"/",e.unit,"] [stock: ",e.stock,"] ")}}function C(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",21),i["\u0275\u0275elementStart"](1,"ul",13),i["\u0275\u0275template"](2,E,4,7,"li",22),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.objects)}}function I(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1," Item not found. Check the spelling. Or "),i["\u0275\u0275elementStart"](2,"a",24),i["\u0275\u0275element"](3,"i",25),i["\u0275\u0275text"](4," click here to add a new product"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}function k(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275elementStart"](1,"input",19),i["\u0275\u0275listener"]("keyup",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().keyUp(t)}))("ngModelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().param=t})),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](2,x,3,0,"div",6),i["\u0275\u0275template"](3,C,3,1,"div",20),i["\u0275\u0275template"](4,I,5,0,"div",6),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngModel",e.param),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.error_search),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.objects.length>0&&e.is_finished_search),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.objects.length<1&&e.is_finished_search)}}let M=(()=>{class e{constructor(e,t,n,r){this.dbService=e,this.notify=t,this.localforage=n,this.authService=r,this.onFinish=new i.EventEmitter,this.btn_text="Select",this.onAdd=new i.EventEmitter,this.type="search",this.show="no",this.param="",this.objects=[],this.selected=null,this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,this.added=[],this.filter_param="",this.filter_results=[],this.local_products=[],this.arrowkeyLocation=0,$(".search_results").on("click",(function(){$("#sales_search").focus()}))}ngOnInit(){"list"!=this.type&&"select"!=this.type||this.list()}hideSearchResults(){this.param="",this.objects.length=0,this.is_finished_search=!1}ngOnChanges(){console.log(this.timestamp),$("#sales_search").focus()}productSelected(){for(let e=0;e<this.objects.length;e++)if(this.objects[e].id==this.select_product){this.onAdd.emit(this.objects[e]);break}}addProduct(){$("#add_product_modal").modal("show")}productAdded(e){console.log(e),e.price=parseFloat(e.price),this.objects.push(e),this.onAdd.emit(e),$("#add_product_modal").modal("hide")}list(){this.is_searching=!0,this.is_finished_search=!1,this.error_search=!1,this.dbService.getData("product/getList",this.authService.current_user).subscribe(e=>{"-1"===e.status?(this.is_searching=!1,this.is_finished_search=!1,this.error_search=!0):(this.objects=e.data,this.filter_results="yes"==this.show?this.objects:[],this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1)},e=>{this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1})}filterlist(){let e=this.filter_param;this.filter_results=null==e||null==e||e.length<1?"yes"==this.show?this.objects:[]:this.objects.filter((function(t){return t.name.toLowerCase().includes(e.toLowerCase())}))}add(e){this.onAdd.emit(e),console.log(e),this.is_finished_search=!1,$("#sales_search").focus(),this.param="",this.objects=[],this.arrowkeyLocation=0}search(){if(""==this.param.trim()||null==this.param||null==this.param)return this.objects=[],void(this.is_finished_search=!1);this.is_searching=!0,this.is_finished_search=!1,this.error_search=!1,this.dbService.getDataWithQuery("product/search",this.authService.current_user,"param="+this.param+"&limit=10").subscribe(e=>{"-1"===e.status?(this.is_searching=!1,this.is_finished_search=!1,this.error_search=!0):(this.objects=e.data,this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1,this.selected=null)},e=>{this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1})}localSearch(){this.is_searching=!0,this.localforage.getItem(this.dbService.PRODUCT_LIST_KEY).subscribe(e=>{if(this.local_products=e,this.is_finished_search=!1,this.error_search=!1,this.param.length<1)return this.objects=[],this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,!1;if(null==this.local_products)return this.objects=[],this.notify.failNotification("No Products! Please refresh the page"),this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,!1;var t=this.param.toLowerCase().trim();console.log(this.param);let n=t.split(" ");var i=this.local_products.filter((function(e){for(let t=0;t<n.length;t++)if(-1==e.name.toLowerCase().indexOf(n[t])&&e.barcode!=n[t])return!1;return!0}));i.sort((function(e,n){let i=e.name.toLowerCase(),r=n.name.toLowerCase();return i.indexOf(t)<r.indexOf(t)?-1:i>r?1:0})),this.objects=i.slice(0,i.length>10?9:i.length),this.is_searching=!1,this.is_finished_search=!0,this.error_search=!1},e=>{this.notify.failNotification("Failed to get products. Please refresh the page")})}select(e){this.selected=e,this.onFinish.emit(e)}highlightObject(e){this.objects.map(e=>{e.selected=!1}),this.highlightedObject=e,e.selected=!0}keyUp(e){switch(e.keyCode){case 38:0==this.arrowkeyLocation||this.arrowkeyLocation--,$(".search_results").scrollTop(0),$(".search_results").scrollTop($(".select-product-active:first").offset().top-$(".search_results").height()+10),console.log($(".select-product-active:first").offset().top-$(".search_results").height()),this.focusCursor();break;case 40:this.arrowkeyLocation==this.objects.length-1||this.arrowkeyLocation++,$(".search_results").scrollTop(0),$(".search_results").scrollTop($(".select-product-active:first").offset().top-$(".search_results").height()+10),console.log($(".select-product-active:first").offset().top-$(".search_results").height()),this.focusCursor();break;case 13:let e=this.objects[this.arrowkeyLocation];null!=e&&null!=e&&this.add(e);break;case 27:this.hideSearchResults();break;default:this.arrowkeyLocation=0,"offline"==this.dbService.ENVIRONMENT?this.search():this.localSearch()}}focusCursor(){let e=$("#sales_search").val();$("#sales_search").val("").val(e)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.a),i["\u0275\u0275directiveInject"](s.a),i["\u0275\u0275directiveInject"](a.LocalForageService),i["\u0275\u0275directiveInject"](o.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["app-select-product"]],inputs:{btn_text:"btn_text",type:"type",show:"show",timestamp:"timestamp"},outputs:{onFinish:"onFinish",onAdd:"onAdd"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:3,vars:3,consts:[["class","",4,"ngIf"],["class","card z-depth-bottom-1",4,"ngIf"],["class","focus_search",4,"ngIf"],[1,""],[1,"body"],[1,"btn","btn-inverse","btn-sm",3,"click"],[4,"ngIf"],["name","products",1,"product",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"card","z-depth-bottom-1"],[1,"card-body"],["class","list-group",4,"ngIf"],[1,"list-group"],[1,"list-group-item"],["placeholder","Search...","type","text","name","filter_param",1,"form-control",3,"ngModel","keyup","ngModelChange"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],[1,"focus_search"],["autofocus","","autocomplete","off","placeholder","Enter product names or barcode","required","","type","text","id","sales_search","name","search",3,"ngModel","keyup","ngModelChange"],["class","search_results ","id","search_results_list",4,"ngIf"],["id","search_results_list",1,"search_results"],["tabindex","-1","class","list-group-item",3,"ngClass","click",4,"ngFor","ngForOf"],["tabindex","-1",1,"list-group-item",3,"ngClass","click"],["routerLink","/add_product"],[1,"feather","icon-plus"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,g,7,3,"div",0),i["\u0275\u0275template"](1,S,7,3,"div",1),i["\u0275\u0275template"](2,k,5,4,"div",2)),2&e&&(i["\u0275\u0275property"]("ngIf","select"==t.type),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","list"==t.type),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","search"==t.type))},directives:[l.j,d.a,c.m,c.e,c.h,l.i,c.i,c.n,c.b,c.l,l.h,h.e],styles:[".link[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline}"]}),e})()},hiAm:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("fXoL");let r=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"fa","fa-spin","fa-spinner"]],template:function(e,t){1&e&&(i["\u0275\u0275element"](0,"i",0),i["\u0275\u0275text"](1," Loading..."))},styles:[""]}),e})()}}]);