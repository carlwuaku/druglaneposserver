(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{mbIT:function(e,t,n){"use strict";t.isArray=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},nBlB:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("ofXK"),i=n("nEHF"),o=n("fXoL");let r=(()=>{class e{}return e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.b,i.a]]}),e})()},"p0+S":function(e,t,n){"use strict";var a=n("mbIT");t.isNumeric=function(e){return!a.isArray(e)&&e-parseFloat(e)+1>=0}},r3Tv:function(e,t,n){"use strict";n.r(t),n.d(t,"StockTakingUploadModule",(function(){return E}));var a=n("ofXK"),i=n("tyNb"),o=n("p0+S"),r=n("fXoL"),l=n("c92J"),s=n("1VJT"),d=n("ccyI"),c=n("3Pt+"),m=n("nVU4");const u=["productsGrid"];function f(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div",11),r["\u0275\u0275elementStart"](1,"div",12),r["\u0275\u0275elementStart"](2,"div",13),r["\u0275\u0275elementStart"](3,"div",14),r["\u0275\u0275text"](4," Instructions: "),r["\u0275\u0275element"](5,"br"),r["\u0275\u0275text"](6," The first row must contain the following column headers. Please make sure all are in lowercase (small caps) and spelled exactly as seen here. The order does not matter. "),r["\u0275\u0275element"](7,"br"),r["\u0275\u0275elementStart"](8,"table",15),r["\u0275\u0275elementStart"](9,"thead"),r["\u0275\u0275elementStart"](10,"tr"),r["\u0275\u0275elementStart"](11,"th"),r["\u0275\u0275text"](12,"Column"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](13,"th"),r["\u0275\u0275text"](14,"Description"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](15,"tbody"),r["\u0275\u0275elementStart"](16,"tr"),r["\u0275\u0275elementStart"](17,"td"),r["\u0275\u0275text"](18,"id"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](19,"td"),r["\u0275\u0275text"](20,"The product id, must be a number. If left blank, the item details will be added to the database as a new product"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](21,"tr"),r["\u0275\u0275elementStart"](22,"td"),r["\u0275\u0275text"](23,"name"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](24,"td"),r["\u0275\u0275text"](25,"required. The product name. If left blank, the item will be skipped."),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](26,"tr"),r["\u0275\u0275elementStart"](27,"td"),r["\u0275\u0275text"](28,"category"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](29,"td"),r["\u0275\u0275text"](30,"optional. E.g. antibiotics. "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](31,"tr"),r["\u0275\u0275elementStart"](32,"td"),r["\u0275\u0275text"](33,"price"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](34,"td"),r["\u0275\u0275text"](35,"required. the selling price of the item. must be a number."),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](36,"tr"),r["\u0275\u0275elementStart"](37,"td"),r["\u0275\u0275text"](38,"cost_price"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](39,"td"),r["\u0275\u0275text"](40,"optional. must be a number if provided."),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](41,"tr"),r["\u0275\u0275elementStart"](42,"td"),r["\u0275\u0275text"](43,"expiry"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](44,"td"),r["\u0275\u0275text"](45,"optional. must be in the format YYYY-MM-DD , e.g. 2020-12-25."),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](46,"tr"),r["\u0275\u0275elementStart"](47,"td"),r["\u0275\u0275text"](48,"counted"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](49,"td"),r["\u0275\u0275text"](50,"required. the actual quantity of the product counted"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](51,"tr"),r["\u0275\u0275elementStart"](52,"td"),r["\u0275\u0275text"](53,"expected"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](54,"td"),r["\u0275\u0275text"](55,"required. the quantity of the item that was expected. i.e. the current stock according to the inventory system. "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](56,"tr"),r["\u0275\u0275elementStart"](57,"td"),r["\u0275\u0275text"](58,"unit"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](59,"td"),r["\u0275\u0275text"](60,"optional. whether per tablet or bottle, etc "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](61,"tr"),r["\u0275\u0275elementStart"](62,"td"),r["\u0275\u0275text"](63,"shelf"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](64,"td"),r["\u0275\u0275text"](65,"optional. the physical location of the item. "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275element"](66,"hr"),r["\u0275\u0275elementStart"](67,"b"),r["\u0275\u0275text"](68,"Click the button below to select the file. It will be automatically processed"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](69,"input",16),r["\u0275\u0275listener"]("ngModelChange",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().filename=t}))("change",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().uploadFile(t)})),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](69),r["\u0275\u0275property"]("ngModel",e.filename)}}const h=function(e,t){return{"text-danger":e,"text-success":t}};function p(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div",17),r["\u0275\u0275elementStart"](1,"div",18),r["\u0275\u0275elementStart"](2,"div",13),r["\u0275\u0275elementStart"](3,"div",19),r["\u0275\u0275elementStart"](4,"h5"),r["\u0275\u0275text"](5,"Confirm the data. You may edit a cell by double-clicking it, typing in the new value, and pressing Enter."),r["\u0275\u0275elementEnd"](),r["\u0275\u0275element"](6,"br"),r["\u0275\u0275elementStart"](7,"button",20),r["\u0275\u0275listener"]("click",(function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().reset()})),r["\u0275\u0275element"](8,"i",21),r["\u0275\u0275text"](9," Cancel and upload another file"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275text"](10),r["\u0275\u0275element"](11,"hr"),r["\u0275\u0275elementStart"](12,"div"),r["\u0275\u0275elementStart"](13,"span"),r["\u0275\u0275elementStart"](14,"b",22),r["\u0275\u0275text"](15),r["\u0275\u0275elementEnd"](),r["\u0275\u0275text"](16," | "),r["\u0275\u0275elementStart"](17,"b",23),r["\u0275\u0275text"](18),r["\u0275\u0275elementEnd"](),r["\u0275\u0275text"](19," | "),r["\u0275\u0275elementStart"](20,"b",24),r["\u0275\u0275text"](21),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](22,"button",25),r["\u0275\u0275listener"]("click",(function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().startSave()})),r["\u0275\u0275text"](23,"Submit & Finish"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](24,"div",14),r["\u0275\u0275elementStart"](25,"ag-grid-angular",26,27),r["\u0275\u0275listener"]("gridReady",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().onGridReady(t)}))("cellValueChanged",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().onCellValueChanged(t)}))("selectionChanged",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().onSelectionChanged(t)})),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](10),r["\u0275\u0275textInterpolate1"](" #",e.code," "),r["\u0275\u0275advance"](5),r["\u0275\u0275textInterpolate1"]("Total Loss: GHC ",e.loss_total.toFixed(2)," "),r["\u0275\u0275advance"](3),r["\u0275\u0275textInterpolate1"]("Total Excess: GHC ",e.excess_total.toFixed(2)," "),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngClass",r["\u0275\u0275pureFunction2"](10,h,e.excess_total+e.loss_total<0,e.loss_total+e.excess_total>0)),r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate1"](" Overall Total: GHC ",(e.excess_total+e.loss_total).toFixed(2),""),r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("rowData",e.objects)("columnDefs",e.columnDefs)("rowClassRules",e.rowClassRules)("defaultColDef",e.defaultColDef)("suppressMenuHide",!0)}}const b=[{path:"",component:(()=>{class e{constructor(e,t,n,a){this.dbService=e,this.notify=t,this.authService=n,this.router=a,this.objects=[],this.filename="",this.show_data=!1,this.columnDefs=[{headerName:"#",valueGetter:"node.rowIndex + 1"},{headerName:"Product",field:"name",sortable:!0,filter:!0,autoHeight:!0,cellClass:"bordered"},{headerName:"Cost Price",field:"cost_price",sortable:!0,filter:!0,editable:!0,cellClass:"bordered"},{headerName:"Selling Price",field:"price",editable:!0,type:"numericColumn",sortable:!0,filter:!0,cellClass:"bordered"},{headerName:"Category",field:"category",sortable:!0,editable:!0,filter:!0,cellClass:"bordered"},{headerName:"Unit",field:"unit",sortable:!0,editable:!0,filter:!0,cellClass:"bordered"},{headerName:"Shelf",field:"shelf",sortable:!0,editable:!0,filter:!0,cellClass:"bordered"},{headerName:"Closest Expiry",field:"expiry",type:"dateColumn",sortable:!0,filter:!0,editable:!0,cellClass:"bordered"},{headerName:"Current Stock",field:"stock",type:"numericColumn",sortable:!0,filter:!0,cellClass:"bordered"},{headerName:"Quantity Counted",field:"quantity",type:"numericColumn",sortable:!0,filter:!0,editable:!0,cellClass:"bordered"},{headerName:"Difference",field:"difference",type:"numericColumn",sortable:!0,filter:!0,cellClass:"bordered"},{headerName:"Total Cost",field:"total_cost",type:"numericColumn",sortable:!0,filter:!0,cellClass:"bordered"},{headerName:"Total Price",field:"total",type:"numericColumn",sortable:!0,filter:!0,cellClass:"bordered"}],this.loss_total=0,this.excess_total=0,this.defaultColDef={resizable:!0},this.rowClassRules={warning:"data.difference < 0",success:"data.difference > 0"}}ngOnInit(){}reset(){this.filename="",this.show_data=!1}onGridReady(e){this.gridApi=e.api,e.api.sizeColumnsToFit()}onSelectionChanged(e){var t=this.gridApi.getSelectedRows();this.selected_items=t[0]}getCode(){this.notify.showLoading(),this.dbService.getData("product/createStockAdjustmentSession",this.authService.current_user).subscribe(e=>{this.notify.hideLoading(),"-1"===e.status?this.notify.failNotification("Server error. Please try again."):"0"===e.status?this.notify.failNotification("Unable to authenticate. Please login again"):"-9"===e.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):this.code=e.data},e=>{this.notify.noConnectionNotification()})}uploadFile(e){let t=e.target.files;if(t.length>0){this.notify.showLoading();let e=t[0];const n=new FormData;n.append("uploadfile",e),this.dbService.postData(n,"product/upload",this.authService.current_user).subscribe(e=>{this.notify.hideLoading(),"-1"===e.status?this.notify.failNotification("Server error. Please try again."):"0"===e.status?this.notify.failNotification("Unable to authenticate. Please login again"):"-9"===e.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):(this.objects=e.data,this.show_data=!0,this.getTotal(),this.getCode())},e=>{this.notify.hideLoading(),this.notify.noConnectionNotification(),console.log(e)})}}onCellValueChanged(e){const t=e.node.id,n=e.oldValue,a=e.column.getId(),i=e.newValue;console.log(e);const r=this.objects[t];switch(a){case"quantity":Object(o.isNumeric)(i)?(null!=r.stock&&null!=r.stock||(r.stock="0"),r.difference=parseFloat(r.quantity)-parseFloat(r.stock),this.getTotal()):(alert("only numbers are accepted for the quantity"),r.quantity=n);break;case"cost_price":case"price":Object(o.isNumeric)(i)?this.getTotal():(alert("only numbers are accepted for the prices"),r.quantity=n)}e.node.setData(r)}getTotal(){let e=0,t=0;this.objects.map(n=>{if(Object(o.isNumeric)(n.quantity)){const a=(n.quantity-parseFloat(n.stock))*n.price,i=Object(o.isNumeric)(n.cost_price)?(n.quantity-parseFloat(n.stock))*n.cost_price:0;n.total=a,n.total_cost=i,n.quantity<parseFloat(n.stock)?e+=a:t+=a}}),this.loss_total=e,this.excess_total=t}startSave(){$("#finish_stock_modal").modal({keyboard:!1,backdrop:"static"})}saveItems(){this.notify.showLoading();const e=[],t=[],n=[],a=[],i=[];let o=[];const r=[],l=[],s=[];let d=[],c=[];for(let u=0;u<this.objects.length;u++){const m=this.objects[u];null!=m.quantity&&null!=m.quantity&&(e.push(m.id),t.push(m.price),n.push(m.quantity),a.push(m.name),i.push(m.stock),o.push(null==m.cost_price||null==m.cost_price?0:m.cost_price),r.push(m.size),l.push(m.category),s.push(m.expiry),d.push(m.unit),c.push(m.shelf))}const m=new FormData;m.append("products",e.join("||")),m.append("prices",t.join("||")),m.append("cost_prices",o.join("||")),m.append("quantities_counted",n.join("||")),m.append("quantities_expected",i.join("||")),m.append("code",this.code),m.append("product_names",a.join("||")),m.append("expiries",s.join("||")),m.append("sizes",r.join("||")),m.append("units",d.join("||")),m.append("damaged",""),m.append("expired",""),m.append("shelves",c.join("||")),m.append("categories",l.join("||")),m.append("created_by",this.authService.current_user.id),m.append("display_name",this.authService.current_user.display_name),m.append("date",this.dbService.getToday()),m.append("created_on",this.dbService.getToday("timestamp")),this.dbService.postData(m,"product/saveStockAdjustment",this.authService.current_user).subscribe(e=>{this.notify.hideLoading(),"-1"===e.status?this.notify.failNotification("Server error. Please try again."):"0"===e.status?this.notify.failNotification("Unable to authenticate. Please login again"):"-9"===e.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):($("#finish_stock_modal").modal("hide"),this.notify.hideLoading(),this.notify.successNotification("Stock adjustment saved successfully"),this.router.navigate(["/stockSessionReport/"+this.code]))},e=>{this.notify.hideLoading(),this.notify.noConnectionNotification(),console.log(e)})}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](l.a),r["\u0275\u0275directiveInject"](s.a),r["\u0275\u0275directiveInject"](d.a),r["\u0275\u0275directiveInject"](i.c))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["app-stock-taking-upload"]],viewQuery:function(e,t){var n;1&e&&r["\u0275\u0275viewQuery"](u,!0),2&e&&r["\u0275\u0275queryRefresh"](n=r["\u0275\u0275loadQuery"]())&&(t.agGrid=n.first)},decls:17,vars:2,consts:[[1,"content"],[1,"container"],["class","row  justify-content-center",4,"ngIf"],["class","row",4,"ngIf"],["id","finish_stock_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-body"],[1,"btn","btn-success",3,"click"],["type","button","data-dismiss","modal",1,"btn","btn-danger"],[1,"row","justify-content-center"],[1,"col-md-10"],[1,"card"],[1,"card-body"],[1,"table","table-bordered","table-striped"],["type","file","name","filename","placeholder","Select excel file","accept",".xlsx",3,"ngModel","ngModelChange","change"],[1,"row"],[1,"col-md-12"],[1,"card-header"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-refresh"],[1,"text-danger"],[1,"text-success"],[3,"ngClass"],[1,"btn","btn-sm","btn-success",3,"click"],["rowSelection","single",1,"ag-theme-balham",2,"width","100%","height","calc(400px)","font-family","Muli","font-size","15px",3,"rowData","columnDefs","rowClassRules","defaultColDef","suppressMenuHide","gridReady","cellValueChanged","selectionChanged"],["productsGrid",""]],template:function(e,t){1&e&&(r["\u0275\u0275elementStart"](0,"section",0),r["\u0275\u0275elementStart"](1,"div",1),r["\u0275\u0275elementStart"](2,"h4"),r["\u0275\u0275text"](3,"Upload Stock Taking Data From Excel File"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](4,f,70,1,"div",2),r["\u0275\u0275template"](5,p,27,13,"div",3),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](6,"div",4),r["\u0275\u0275elementStart"](7,"div",5),r["\u0275\u0275elementStart"](8,"div",6),r["\u0275\u0275elementStart"](9,"div",7),r["\u0275\u0275elementStart"](10,"h5"),r["\u0275\u0275text"](11,"Sure you are done?"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](12,"div",8),r["\u0275\u0275elementStart"](13,"button",9),r["\u0275\u0275listener"]("click",(function(){return t.saveItems()})),r["\u0275\u0275text"](14,"Yes, submit and finish this session"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](15,"button",10),r["\u0275\u0275text"](16,"No, go back"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e&&(r["\u0275\u0275advance"](4),r["\u0275\u0275property"]("ngIf",!t.show_data),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",t.show_data))},directives:[a.j,c.b,c.e,c.h,a.h,m.AgGridAngular],styles:[""]}),e})()}];let y=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.f.forChild(b)],i.f]}),e})();var g=n("nEHF"),S=n("rNAZ"),x=n("nBlB");let E=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.b,y,g.a,S.a,x.a]]}),e})()},rNAZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("ofXK"),i=n("nEHF"),o=n("6QD7"),r=n("fXoL");let l=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.b,i.a,o.b],o.b]}),e})()}}]);