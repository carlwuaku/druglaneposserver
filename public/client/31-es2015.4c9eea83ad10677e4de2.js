(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"9EpT":function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}));var i=n("fXoL");const r=["bcElement"],a=n("YsXA");let s=(()=>{class t{constructor(t){this.renderer=t,this.elementType="svg",this.cssClass="barcode",this.format="CODE128",this.lineColor="#000000",this.width=2,this.height=100,this.displayValue=!1,this.fontOptions="",this.font="monospace",this.textAlign="center",this.textPosition="bottom",this.textMargin=2,this.fontSize=20,this.background="#ffffff",this.margin=10,this.marginTop=10,this.marginBottom=10,this.marginLeft=10,this.marginRight=10,this.value="",this.valid=()=>!0}get options(){return{format:this.format,lineColor:this.lineColor,width:this.width,height:this.height,displayValue:this.displayValue,fontOptions:this.fontOptions,font:this.font,textAlign:this.textAlign,textPosition:this.textPosition,textMargin:this.textMargin,fontSize:this.fontSize,background:this.background,margin:this.margin,marginTop:this.marginTop,marginBottom:this.marginBottom,marginLeft:this.marginLeft,marginRight:this.marginRight,valid:this.valid}}ngOnChanges(){this.createBarcode()}createBarcode(){if(!this.value)return;let t;switch(this.elementType){case"img":t=this.renderer.createElement("img");break;case"canvas":t=this.renderer.createElement("canvas");break;case"svg":default:t=this.renderer.createElement("svg","svg")}a(t,this.value,this.options);for(const e of this.bcElement.nativeElement.childNodes)this.renderer.removeChild(this.bcElement.nativeElement,e);this.renderer.appendChild(this.bcElement.nativeElement,t)}}return t.\u0275fac=function(e){return new(e||t)(i["\u0275\u0275directiveInject"](i.Renderer2))},t.\u0275cmp=i["\u0275\u0275defineComponent"]({type:t,selectors:[["ngx-barcode6"]],viewQuery:function(t,e){var n;1&t&&i["\u0275\u0275staticViewQuery"](r,!0),2&t&&i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(e.bcElement=n.first)},inputs:{elementType:["bc-element-type","elementType"],cssClass:["bc-class","cssClass"],format:["bc-format","format"],lineColor:["bc-line-color","lineColor"],width:["bc-width","width"],height:["bc-height","height"],displayValue:["bc-display-value","displayValue"],fontOptions:["bc-font-options","fontOptions"],font:["bc-font","font"],textAlign:["bc-text-align","textAlign"],textPosition:["bc-text-position","textPosition"],textMargin:["bc-text-margin","textMargin"],fontSize:["bc-font-size","fontSize"],background:["bc-background","background"],margin:["bc-margin","margin"],marginTop:["bc-margin-top","marginTop"],marginBottom:["bc-margin-bottom","marginBottom"],marginLeft:["bc-margin-left","marginLeft"],marginRight:["bc-margin-right","marginRight"],value:["bc-value","value"],valid:["bc-valid","valid"]},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:2,consts:[["bcElement",""]],template:function(t,e){1&t&&i["\u0275\u0275element"](0,"div",null,0),2&t&&i["\u0275\u0275classMap"](e.cssClass)},encapsulation:2}),t})(),o=(()=>{class t{}return t.\u0275mod=i["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=i["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[]]}),t})()},hiAm:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("fXoL");let r=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i["\u0275\u0275defineComponent"]({type:t,selectors:[["app-loading"]],decls:2,vars:0,consts:[[1,"fa","fa-spin","fa-spinner"]],template:function(t,e){1&t&&(i["\u0275\u0275element"](0,"i",0),i["\u0275\u0275text"](1," Loading..."))},styles:[""]}),t})()},nBlB:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("ofXK"),r=n("nEHF"),a=n("9EpT"),s=n("fXoL");let o=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.b,r.a,a.b]]}),t})()},pEcs:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var i=n("fXoL");class r{constructor(){}}var a=n("c92J"),s=n("ccyI"),o=n("1VJT"),l=n("ofXK"),c=n("3Pt+"),d=n("hiAm");function m(t,e){if(1&t){const t=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](t),i["\u0275\u0275nextContext"](3).addItem()})),i["\u0275\u0275element"](1,"i",9),i["\u0275\u0275elementEnd"]()}}function h(t,e){if(1&t){const t=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",10),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](t),i["\u0275\u0275nextContext"](3).list()})),i["\u0275\u0275element"](1,"i",11),i["\u0275\u0275elementEnd"]()}}function p(t,e){if(1&t&&(i["\u0275\u0275elementStart"](0,"option",12),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;i["\u0275\u0275propertyInterpolate"]("value",t.id),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"](" ",t.name," ")}}function u(t,e){if(1&t){const t=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275template"](1,m,2,0,"button",4),i["\u0275\u0275template"](2,h,2,0,"button",5),i["\u0275\u0275elementStart"](3,"select",6),i["\u0275\u0275listener"]("ngModelChange",(function(e){return i["\u0275\u0275restoreView"](t),i["\u0275\u0275nextContext"](2).selected_item=e}))("change",(function(){return i["\u0275\u0275restoreView"](t),i["\u0275\u0275nextContext"](2).itemSelected()})),i["\u0275\u0275template"](4,p,2,2,"option",7),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&t){const t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.show_add),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.show_add),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngModel",t.selected_item),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngForOf",t.objects)}}function f(t,e){if(1&t&&(i["\u0275\u0275elementStart"](0,"span",2),i["\u0275\u0275template"](1,u,5,4,"span",3),i["\u0275\u0275elementEnd"]()),2&t){const t=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.is_loaded)}}function g(t,e){1&t&&i["\u0275\u0275element"](0,"app-loading")}function y(t,e){1&t&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275elementStart"](1,"h4"),i["\u0275\u0275text"](2,"Not found"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}function b(t,e){if(1&t){const t=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"a",18),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](t);const n=e.$implicit;return i["\u0275\u0275nextContext"](3).add(n)})),i["\u0275\u0275elementStart"](1,"b"),i["\u0275\u0275text"](2),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](3,"i",19),i["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate1"]("",t.name," ")}}function v(t,e){if(1&t&&(i["\u0275\u0275elementStart"](0,"div",16),i["\u0275\u0275template"](1,b,4,1,"a",17),i["\u0275\u0275elementEnd"]()),2&t){const t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngForOf",t.objects)}}function x(t,e){if(1&t&&(i["\u0275\u0275elementStart"](0,"div",13),i["\u0275\u0275elementStart"](1,"div",14),i["\u0275\u0275template"](2,g,1,0,"app-loading",3),i["\u0275\u0275template"](3,y,3,0,"div",3),i["\u0275\u0275template"](4,v,2,1,"div",15),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&t){const t=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.is_searching),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.error_search),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.is_finished_search)}}let _=(()=>{class t{constructor(t,e,n){this.dbService=t,this.authService=e,this.notify=n,this.onFinish=new i.EventEmitter,this.btn_text="Select",this.onAdd=new i.EventEmitter,this.type="select",this.show_add=!0,this.param="",this.selected=null,this.is_searching=!1,this.is_finished_search=!1,this.error_search=!1,this.is_loaded=!1,this.added=[]}ngOnInit(){console.log(this.type),"list"!=this.type&&"select"!=this.type||this.list(),"emit"==this.type&&this.getAll()}itemSelected(){for(var t=0;t<this.objects.length;t++)if(this.objects[t].id==this.selected_item){this.onFinish.emit(this.objects[t]);break}}itemAdded(t){this.objects.push(t),$("#add_vendor_modal").modal("hide"),this.onFinish.emit(t)}list(){this.is_loaded=!1,this.notify.showLoading(),this.dbService.getData("admin/getBranches?only_others=yes",this.authService.current_user).subscribe(t=>{this.notify.hideLoading(),"-1"===t.status||(this.objects=t.data,this.is_loaded=!0)},t=>{this.notify.hideLoading(),this.notify.noConnectionNotification()})}getAll(){this.is_loaded=!1,this.notify.showLoading();let t="admin/getBranches?only_others=no";"admin"==this.authService.current_user.type&&(t+="&parent_company_id="+this.authService.current_user.parent_company_id),this.dbService.getData(t,this.authService.current_user).subscribe(t=>{this.notify.hideLoading(),"-1"===t.status||(this.objects=t.data,this.onFinish.emit(this.objects),this.is_loaded=!0)},t=>{this.notify.hideLoading(),this.notify.noConnectionNotification()})}add(t){this.added.push(t),this.onAdd.emit(t),t.is_selected=!0}select(t){this.selected=t,this.onFinish.emit(t)}addItem(){this.notify.showLoading();let t=window.prompt("Enter name of branch");if(this.dbService.isEmpty(t))return this.notify.failNotification("name is required"),!1;let e=window.prompt("Enter phone number of branch");if(this.dbService.isEmpty(e))return this.notify.failNotification("Phone number is required"),!1;let n=new FormData;n.append("name",t),n.append("phone",e),this.dbService.postData(n,"admin/saveBranch",this.authService.current_user).subscribe(n=>{if(this.notify.hideLoading(),"-1"===n.status)this.notify.failNotification("Server error. Please try again");else if("-1"===n.status)this.notify.failNotification("Unable to authenticate. Please login again");else if("-9"===n.status)this.notify.showNotification("You are not permitted to perform this action","fail",3e3);else{let i=new r;i.id=n.status,i.name=t,i.phone=e,this.objects.push(i),this.notify.successNotification("Branch added successfully"),this.selected_item=i.id,this.itemSelected()}},t=>{this.notify.noConnectionNotification()})}}return t.\u0275fac=function(e){return new(e||t)(i["\u0275\u0275directiveInject"](a.a),i["\u0275\u0275directiveInject"](s.a),i["\u0275\u0275directiveInject"](o.a))},t.\u0275cmp=i["\u0275\u0275defineComponent"]({type:t,selectors:[["app-select-branch"]],inputs:{btn_text:"btn_text",type:"type",show_add:"show_add",selected_item:"selected_item"},outputs:{onFinish:"onFinish",onAdd:"onAdd"},decls:2,vars:2,consts:[["class","",4,"ngIf"],["class","card",4,"ngIf"],[1,""],[4,"ngIf"],["type","button","class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-sm btn-info",3,"click",4,"ngIf"],["name","vendors",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"fa","fa-plus"],["type","button",1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-refresh"],[3,"value"],[1,"card"],[1,"body"],["class","list-group",4,"ngIf"],[1,"list-group"],["class","list-group-item",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",3,"click"],[1,"fa","fa-plus","pull-right"]],template:function(t,e){1&t&&(i["\u0275\u0275template"](0,f,2,1,"span",0),i["\u0275\u0275template"](1,x,5,3,"div",1)),2&t&&(i["\u0275\u0275property"]("ngIf","select"==e.type),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","list"==e.type))},directives:[l.j,c.m,c.e,c.h,l.i,c.i,c.n,d.a],styles:[""]}),t})()},pGBO:function(t,e,n){"use strict";n.r(e),n.d(e,"TransferFormModule",(function(){return C}));var i=n("ofXK"),r=n("tyNb");class a{constructor(){}}var s=n("fXoL"),o=n("c92J"),l=n("bgkY"),c=n("1VJT"),d=n("eJvr"),m=n("ccyI"),h=n("4j6H"),p=n("pEcs"),u=n("3Pt+"),f=n("6QD7");function g(t,e){1&t&&(s["\u0275\u0275elementStart"](0,"em",45),s["\u0275\u0275element"](1,"br"),s["\u0275\u0275element"](2,"i",46),s["\u0275\u0275text"](3," Possibly expired"),s["\u0275\u0275elementEnd"]())}function y(t,e){1&t&&s["\u0275\u0275element"](0,"i",47)}const b=function(t){return{"table-warning":t}};function v(t,e){if(1&t){const t=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"tr",37),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275template"](3,g,4,0,"em",38),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](4,"td"),s["\u0275\u0275text"](5),s["\u0275\u0275element"](6,"br"),s["\u0275\u0275elementStart"](7,"button",39),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](t);const n=e.$implicit;return s["\u0275\u0275nextContext"]().editItem(n)})),s["\u0275\u0275text"](8," ... "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](9,"button",40),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](t);const n=e.$implicit;return s["\u0275\u0275nextContext"]().increment(n)})),s["\u0275\u0275text"](10," +1 "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](11,"button",41),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](t);const n=e.$implicit;return s["\u0275\u0275nextContext"]().decrement(n)})),s["\u0275\u0275text"](12," -1 "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](13,"td"),s["\u0275\u0275text"](14),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](15,"td"),s["\u0275\u0275text"](16),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](17,"td"),s["\u0275\u0275text"](18),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](19,"td"),s["\u0275\u0275text"](20),s["\u0275\u0275template"](21,y,1,0,"i",42),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](22,"td"),s["\u0275\u0275text"](23),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](24,"td"),s["\u0275\u0275elementStart"](25,"button",43),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](t);const n=e.$implicit;return s["\u0275\u0275nextContext"]().removeItem(n)})),s["\u0275\u0275element"](26,"i",44),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;s["\u0275\u0275property"]("ngClass",s["\u0275\u0275pureFunction1"](10,b,t.stock<1||t.quantity>t.stock)),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("",t.product_name," "),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.expired),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" ",t.quantity," "),s["\u0275\u0275advance"](9),s["\u0275\u0275textInterpolate1"]("",t.cost_price," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](t.price),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"]((t.price*t.quantity).toFixed(2)),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("",t.stock," "),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.stock<1||t.quantity>t.stock),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](t.expiry)}}function x(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"h5"),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"]("Quantity & Expiry for ",t.new_item.name,"")}}function _(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275text"](4),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"td"),s["\u0275\u0275text"](6),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](7,"td"),s["\u0275\u0275text"](8),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](t.product.name),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](t.quantity),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate"](t.price),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("",(t.quantity*t.price).toFixed(2)," ")}}const S=[{path:"",component:(()=>{class t{constructor(t,e,n,i,r){this.dbService=t,this.socket=e,this.notify=n,this.localforage=i,this.authService=r,this.items=[],this.new_item=null,this.new_quantity="",this.new_expiry="",this.new_cost_price="",this.sale_total=0,this.receipt_items=[],this.invoice_items=[],this.receipt_total=0,this.time="",this.digital_address="",this.ts="",this.key_state="none",this.title="Transfer Items to another branch",-1==this.authService.current_user.permissions.indexOf("Transfer Items")&&(this.notify.failNotification("You are not permitted to view that page"),this.dbService.goBackHome()),this.company_address=r.current_user.company_address,this.company_phone=r.current_user.company_phone,this.company_name=r.current_user.company_name,this.cashier=r.current_user.display_name,this.digital_address=r.current_user.digital_address,this.dbService.setTitle(this.title)}keyEvent(t){if("Home"==t.code)console.log("home"),this.ts=this.dbService.getToday("timestamp_string");else if(27==t.keyCode)switch(this.key_state){case"item_quantity":this.rejectItem()}}ngOnInit(){this.ts=this.dbService.getToday(),$("#sales_search").focus()}productSelected(t){if(console.log(t),this.new_item=t,this.new_item.stock=0,"number"!=typeof t.price)return this.notify.failNotification("Price not defined."),!1;let e=!1;for(let n=0;n<this.items.length;n++)if(this.items[n].product_id==t.id){e=!0;break}if(e)return this.notify.failNotification("Item is already in the list"),!1;this.getItemStock(),this.showQuantityModal()}showQuantityModal(){this.key_state="item_quantity",this.new_expiry=this.new_item.expiry,this.new_cost_price=this.new_item.cost_price,$("#transfer_quantity_modal").modal({backdrop:"static",keyboard:!1}),$("#transfer_quantity_modal").on("shown.bs.modal",(function(){$("#transfer_new_quantity").focus()}))}getItemStock(){let t=this.new_item.id;this.dbService.getData("product/getStock?id="+this.new_item.id,this.authService.current_user).subscribe(e=>{if("1"==e.status){this.new_item.stock=e.data;for(let n=0;n<this.items.length;n++)if(this.items[n].product_id==t){this.items[n].stock=e.data;break}}},t=>{this.notify.failNotification("Unable to get stock. Check connection")})}acceptItem(){var t=new a;t.product_name=this.new_item.name,t.product_id=this.new_item.id,t.price=this.new_item.price,t.quantity=this.new_quantity,t.total=this.new_quantity*this.new_item.price,t.stock=this.new_item.stock,t.product=this.new_item,t.expired=this.new_item.expired,t.expiry=this.new_expiry,t.cost_price=parseFloat(this.new_cost_price),this.items.push(t),this.getTotal(),$("#transfer_quantity_modal").modal("hide"),this.new_quantity="",this.ts=this.dbService.getToday("timestamp_string")}rejectItem(){$("#transfer_quantity_modal").modal("hide"),this.new_quantity="",this.ts=this.dbService.getToday("timestamp_string")}getTotal(){var t=0;this.items.map(e=>{t+=e.quantity*e.price}),this.sale_total=t,this.receipt_total=t}removeItem(t){this.items.splice(this.items.indexOf(t),1),this.getTotal()}editItem(t){this.new_item=t.product,this.items.splice(this.items.indexOf(t),1),this.getTotal(),this.new_item=t.product,this.new_quantity=t.quantity,$("#transfer_quantity_modal").modal({backdrop:"static",keyboard:!1}),$("#transfer_quantity_modal").on("shown.bs.modal",(function(){$("#qtt").focus()}))}setQuantities(){var t=0,e=this;$(".quantities").each((function(){e.items[t].quantity=$(this).val(),t++})),this.getTotal()}saveItems(){if(null==this.items||null==this.items||this.items.length<1)return this.notify.failNotification("Please add at least one product"),!1;if(null==this.receiver_id||null==this.receiver_id)return this.notify.failNotification("Please select the receiving branch"),!1;this.notify.showLoading();var t=[],e=[],n=[],i=[],r=[],a=[];this.ts=this.dbService.getToday("timestamp_string");for(var s=0;s<this.items.length;s++)t.push((o=this.items[s]).product_id),e.push(o.price),n.push(o.quantity),i.push(o.product_name),r.push(o.expiry),a.push(o.cost_price);for(this.receipt_items=[],s=0;s<this.items.length;s++){var o;this.receipt_items.push(o=this.items[s])}let l=new FormData;l.append("products",t.join("||")),l.append("prices",e.join("||")),l.append("quantities",n.join("||")),l.append("product_names",i.join("||")),l.append("expiries",r.join("||")),l.append("created_by",this.authService.current_user.id),l.append("date",this.dbService.getToday()),l.append("created_on",this.dbService.getToday("timestamp")),l.append("display_name",this.authService.current_user.display_name),l.append("receiver",this.receiver_id),l.append("receiver_name",this.receiver_name),l.append("cost_prices",a.join("||")),this.dbService.postData(l,"transfer/saveBulk",this.authService.current_user).subscribe(t=>{this.notify.hideLoading(),"0"===t.status?(this.notify.failNotification("Unable to authenticate. Please login again"),this.authService.logout()):"-1"===t.status?this.notify.failNotification("Server error. Please try again"):"-9"===t.status?this.notify.showNotification("You are not permitted to perform this action","fail",3e3):(this.time=this.dbService.getToday("timestamp"),console.log(t.code),this.selected_code=t.code,console.log("selected code set to "+this.selected_code),this.notify.hideLoading(),this.socket.sendEvent({sender_id:this.authService.current_user.company_id,receiver_id:this.receiver_id,message:"New transfer of items from "+this.authService.current_user.company_name,event:"new_transfer"}),this.notify.successNotification("Transfers saved successfully"),this.finishSale())},t=>{this.notify.hideLoading(),this.notify.noConnectionNotification(),console.log(t)})}sync(){}increment(t){null!=t&&null!=t?(t.quantity=(parseFloat(t.quantity)+1).toString(),this.getTotal()):(this.dbService.isEmpty(this.new_quantity)&&(this.new_quantity=0),this.new_quantity++,$("#transfer_new_quantity").focus(),this.focusCursor())}decrement(t){null!=t&&null!=t?parseFloat(t.quantity)>1&&(t.quantity=(parseFloat(t.quantity)-1).toString(),this.getTotal()):(this.dbService.isEmpty(this.new_quantity)&&(this.new_quantity=0),parseFloat(this.new_quantity)>1&&this.new_quantity--,$("#transfer_new_quantity").focus(),this.focusCursor())}keyChangeQuantity(t){40==t.keyCode?this.decrement():38==t.keyCode&&this.increment(),this.focusCursor()}focusCursor(){let t=$("#transfer_new_quantity").val();$("#transfer_new_quantity").val("").val(t)}finishSale(){var t=this;this.ts=this.dbService.getToday("timestamp_string"),setTimeout(()=>{t.print(),this.items=[],this.getTotal()},1e3)}cancel(){this.items=[],this.getTotal()}goBack(){window.history.back()}keyUp(t){}print(){var t=0;let e,n;e="",this.receipt_items.map(e=>{t+=e.quantity*e.product.price}),this.receipt_total=t,e=document.getElementById("invoice").innerHTML,n=window.open("","_blank","top=0,left=0,height=100%,width=auto"),n.document.open(),n.document.write(`\n          <html>\n            <head>\n              <title>Invoice</title>\n              <style>\n              body{\n                font-size: 13px;\n              }\n              #invoice { page-break-after: always; }\n    #invoice:last-child { page-break-after: avoid; }\n    \n\n    table{\n        width: 100%;\n        border: 1px solid #e9ecef;\n        font-size: 13px !important;\n    }\n\n    .small-margin{\n      margin-bottom: 10px;\n    }\n\n    .table-bordered{border:1px solid #dee2e6}.table-bordered td,.table-bordered th{border:1px solid #dee2e6}.table-bordered thead td,.table-bordered thead th{border-bottom-width:2px}\n           .center{\n             text-align:center\n           }\n           .text-left{text-align:left!important}.text-right{text-align:right!important; float:right}\n           .text-center{text-align:center!important}\n           @media (min-width:576px){.text-sm-left{text-align:left!important}\n           .text-sm-right{text-align:right!important}\n           .text-sm-center{text-align:center!important}}\n           @media (min-width:768px){.text-md-left{text-align:left!important}\n           .text-md-right{text-align:right!important}\n           .text-md-center{text-align:center!important}}@media (min-width:992px){.text-lg-left{text-align:left!important}.text-lg-right{text-align:right!important}.text-lg-center{text-align:center!important}}@media (min-width:1200px){.text-xl-left{text-align:left!important}.text-xl-right{text-align:right!important}.text-xl-center{text-align:center!important}}.text-lowercase{text-transform:lowercase!important}.text-uppercase{text-transform:uppercase!important}.text-capitalize{text-transform:capitalize!important}\n\n           .row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}\n              </style>\n            </head>\n        <body onload="window.print();"><div id="invoice">${e}</div> \n        <script>\n           window.onafterprint = function(){\n            window.close();\n          }\n           <\/script>\n           </body>\n          </html>`),n.document.close()}setRecipient(t){this.receiver_id=t.id,this.receiver_name=t.name,this.receiver_address=t.address,this.receiver_digital_address=t.digital_address,this.receiver_phone=t.phone}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](o.a),s["\u0275\u0275directiveInject"](l.a),s["\u0275\u0275directiveInject"](c.a),s["\u0275\u0275directiveInject"](d.a),s["\u0275\u0275directiveInject"](m.a))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["app-transfer-form"]],hostBindings:function(t,e){1&t&&s["\u0275\u0275listener"]("keydown",(function(t){return e.keyEvent(t)}),!1,s["\u0275\u0275resolveWindow"])},decls:132,vars:27,consts:[[1,"content"],[1,"container"],[1,"row"],[1,"col-md-5"],[1,"col-md-7"],[3,"live_server","timestamp","type","show","onAdd"],[1,"col-12"],[1,"card","card-body","table-responsive","transfer_items"],[1,"table","table-striped","table-bordered","table-hover"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card-body","sales-fixed-bottom"],[1,"col-4"],[3,"type","onFinish"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],["id","transfer_quantity_modal","tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-sm"],[1,"modal-content"],["ngNativeValidate","",3,"ngSubmit"],["n","ngForm"],[1,"modal-body"],[4,"ngIf"],["type","text","autocomplete","off","required","","id","transfer_new_quantity","name","new_quantity",3,"ngModel","keyup","ngModelChange"],["type","button",1,"btn","btn-sm","btn-info",3,"click"],["type","button",1,"btn","btn-sm","btn-warning",3,"click"],["type","date","required","","id","transfer_new_expiry","name","new_expiry",3,"ngModel","ngModelChange"],["type","text","required","","id","transfer_new_cost_price","name","new_cost_price",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-danger",3,"click"],["id","invoice"],[1,"text-left"],[1,"text-right"],[1,"text-center"],[1,"table"],[4,"ngFor","ngForOf"],[3,"bc-value","bc-height","bc-font-size","bc-display-value"],[3,"ngClass"],["class","text-muted",4,"ngIf"],["title","custom quantity",1,"btn","btn-info","btn-sm",3,"click"],["title","increase quantity by 1",1,"btn","btn-info","btn-sm",3,"click"],["title","decrease quantity by 1",1,"btn","btn-info","btn-sm",3,"click"],["title","The quantity entered is more than the current stock","class","text-danger fa fa-exclamation-triangle",4,"ngIf"],[1,"btn","btn-warning","btn-sm",3,"click"],[1,"fa","fa-remove"],[1,"text-muted"],["title","Item expired",1,"fa","fa-calendar","text-danger"],["title","The quantity entered is more than the current stock",1,"text-danger","fa","fa-exclamation-triangle"]],template:function(t,e){1&t&&(s["\u0275\u0275elementStart"](0,"section",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"div",2),s["\u0275\u0275elementStart"](3,"div",3),s["\u0275\u0275elementStart"](4,"h5"),s["\u0275\u0275text"](5),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](6,"div",4),s["\u0275\u0275elementStart"](7,"app-select-product",5),s["\u0275\u0275listener"]("onAdd",(function(t){return e.productSelected(t)})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"div",2),s["\u0275\u0275elementStart"](9,"div",6),s["\u0275\u0275elementStart"](10,"div",7),s["\u0275\u0275elementStart"](11,"table",8),s["\u0275\u0275elementStart"](12,"thead"),s["\u0275\u0275elementStart"](13,"tr"),s["\u0275\u0275elementStart"](14,"th"),s["\u0275\u0275text"](15,"Product"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](16,"th"),s["\u0275\u0275text"](17,"Quantity"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](18,"th"),s["\u0275\u0275text"](19,"Cost Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](20,"th"),s["\u0275\u0275text"](21,"Selling Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](22,"th"),s["\u0275\u0275text"](23,"Total"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](24,"th"),s["\u0275\u0275text"](25,"On-hand"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](26,"th"),s["\u0275\u0275text"](27,"Expiry"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](28,"th"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](29,"tbody"),s["\u0275\u0275template"](30,v,27,12,"tr",9),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](31,"div",6),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](32,"div",10),s["\u0275\u0275elementStart"](33,"div",2),s["\u0275\u0275elementStart"](34,"div",11),s["\u0275\u0275elementStart"](35,"b"),s["\u0275\u0275text"](36),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](37,"div",11),s["\u0275\u0275elementStart"](38,"b"),s["\u0275\u0275text"](39,"Recipient"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](40,"app-select-branch",12),s["\u0275\u0275listener"]("onFinish",(function(t){return e.setRecipient(t)})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](41,"div",11),s["\u0275\u0275elementStart"](42,"button",13),s["\u0275\u0275listener"]("click",(function(){return e.cancel()})),s["\u0275\u0275text"](43,"Cancel"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](44,"button",14),s["\u0275\u0275listener"]("click",(function(){return e.saveItems()})),s["\u0275\u0275text"](45,"Save"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](46,"div",15),s["\u0275\u0275elementStart"](47,"div",16),s["\u0275\u0275elementStart"](48,"div",17),s["\u0275\u0275elementStart"](49,"form",18,19),s["\u0275\u0275listener"]("ngSubmit",(function(){return e.acceptItem()})),s["\u0275\u0275elementStart"](51,"div",20),s["\u0275\u0275template"](52,x,2,1,"h5",21),s["\u0275\u0275elementStart"](53,"div"),s["\u0275\u0275elementStart"](54,"label"),s["\u0275\u0275text"](55,"Quantity"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](56,"br"),s["\u0275\u0275elementStart"](57,"input",22),s["\u0275\u0275listener"]("keyup",(function(t){return e.keyChangeQuantity(t)}))("ngModelChange",(function(t){return e.new_quantity=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](58,"br"),s["\u0275\u0275elementStart"](59,"button",23),s["\u0275\u0275listener"]("click",(function(){return e.increment()})),s["\u0275\u0275text"](60,"+1"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](61,"button",24),s["\u0275\u0275listener"]("click",(function(){return e.decrement()})),s["\u0275\u0275text"](62,"-1"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](63,"div"),s["\u0275\u0275elementStart"](64,"label"),s["\u0275\u0275text"](65,"Expiry Date"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](66,"input",25),s["\u0275\u0275listener"]("ngModelChange",(function(t){return e.new_expiry=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](67,"div"),s["\u0275\u0275elementStart"](68,"label"),s["\u0275\u0275text"](69,"Cost Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](70,"input",26),s["\u0275\u0275listener"]("ngModelChange",(function(t){return e.new_cost_price=t})),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](71,"div",27),s["\u0275\u0275elementStart"](72,"button",28),s["\u0275\u0275text"](73,"Accept"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](74,"button",29),s["\u0275\u0275listener"]("click",(function(){return e.rejectItem()})),s["\u0275\u0275text"](75,"Cancel"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](76,"div",30),s["\u0275\u0275elementStart"](77,"div"),s["\u0275\u0275elementStart"](78,"div"),s["\u0275\u0275elementStart"](79,"span",31),s["\u0275\u0275text"](80),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](81,"span",32),s["\u0275\u0275text"](82),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](83,"br"),s["\u0275\u0275elementStart"](84,"div",33),s["\u0275\u0275elementStart"](85,"h4"),s["\u0275\u0275text"](86,"TRANSFER INVOICE "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](87,"b"),s["\u0275\u0275text"](88,"FROM:"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](89,"b"),s["\u0275\u0275text"](90),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](91,"br"),s["\u0275\u0275text"](92),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](93,"div",33),s["\u0275\u0275elementStart"](94,"b"),s["\u0275\u0275text"](95,"TO: "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](96,"b"),s["\u0275\u0275text"](97),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](98,"br"),s["\u0275\u0275text"](99),s["\u0275\u0275element"](100,"br"),s["\u0275\u0275text"](101),s["\u0275\u0275element"](102,"br"),s["\u0275\u0275text"](103),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](104,"br"),s["\u0275\u0275elementStart"](105,"b"),s["\u0275\u0275text"](106,"By:"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275text"](107),s["\u0275\u0275element"](108,"hr"),s["\u0275\u0275elementStart"](109,"table",34),s["\u0275\u0275elementStart"](110,"thead"),s["\u0275\u0275elementStart"](111,"tr"),s["\u0275\u0275elementStart"](112,"th"),s["\u0275\u0275text"](113,"Item Name"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](114,"th"),s["\u0275\u0275text"](115,"Qty"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](116,"th"),s["\u0275\u0275text"](117,"Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](118,"th"),s["\u0275\u0275text"](119,"Ext. Price"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](120,"tbody"),s["\u0275\u0275template"](121,_,9,4,"tr",35),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](122,"br"),s["\u0275\u0275element"](123,"br"),s["\u0275\u0275elementStart"](124,"div"),s["\u0275\u0275elementStart"](125,"b",32),s["\u0275\u0275text"](126),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](127,"br"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](128,"div",33),s["\u0275\u0275element"](129,"ngx-barcode",36),s["\u0275\u0275element"](130,"br"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275element"](131,"br"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&t&&(s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",e.title," "),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("live_server",!0)("timestamp",e.ts)("type","search")("show","no"),s["\u0275\u0275advance"](23),s["\u0275\u0275property"]("ngForOf",e.items),s["\u0275\u0275advance"](6),s["\u0275\u0275textInterpolate1"]("Total: GHC ",e.sale_total.toFixed(2)," "),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("type","select"),s["\u0275\u0275advance"](12),s["\u0275\u0275property"]("ngIf",null!=e.new_item),s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngModel",e.new_quantity),s["\u0275\u0275advance"](9),s["\u0275\u0275property"]("ngModel",e.new_expiry),s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngModel",e.new_cost_price),s["\u0275\u0275advance"](10),s["\u0275\u0275textInterpolate1"]("",e.time," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("#",e.selected_code,""),s["\u0275\u0275advance"](8),s["\u0275\u0275textInterpolate1"]("",e.company_name," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" ",e.company_phone," "),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("",e.receiver_name," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" ",e.receiver_address," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" DIGITAL ADDRESS ",e.receiver_digital_address," "),s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"](" ",e.receiver_phone," "),s["\u0275\u0275advance"](4),s["\u0275\u0275textInterpolate1"](" ",e.cashier," "),s["\u0275\u0275advance"](14),s["\u0275\u0275property"]("ngForOf",e.receipt_items),s["\u0275\u0275advance"](5),s["\u0275\u0275textInterpolate1"]("TOTAL: ",e.receipt_total.toFixed(2)," "),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("bc-value",e.selected_code)("bc-height",35)("bc-font-size",13)("bc-display-value",!0))},directives:[h.a,i.i,p.a,u.f,u.g,i.j,u.b,u.l,u.e,u.h,f.a,i.h],styles:[""]}),t})()}];let w=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.f.forChild(S)],r.f]}),t})();var E=n("nEHF"),I=n("wDHj"),k=n("nBlB");let C=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.b,w,E.a,I.a,k.a]]}),t})()},wDHj:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("ofXK"),r=n("nEHF"),a=n("6QD7"),s=n("fXoL");let o=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.b,r.a,a.b],a.b]}),t})()}}]);